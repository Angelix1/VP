(function(C,t,I,l,O,S,T,y,D){"use strict";const{FormRow:b,FormSwitch:P,FormSwitchRow:G,FormSection:V,FormDivider:_,FormInput:k}=S.Forms,{ScrollView:B,View:h,Text:u}=S.General,r=t.stylesheet.createThemedStyleSheet({text:{color:T.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:T.semanticColors.TEXT_POSITIVE,paddingLeft:"6%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.DISPLAY_NORMAL,fontSize:12}});let F=function(e){return e.toUpperCase()},v=[{id:"deletedMessageColor",title:"Customize Deleted Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"E40303"},{id:"deletedMessage",title:"Customize Deleted Message",type:"default",placeholder:"This message is deleted"},{id:"editedMessage",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"},{id:"deletedMessageColorBackground",title:"Customize Deleted Background Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"FF2C2F"}];const A=[{id:"useBackgroundColor",default:!1,label:"Enable Background Color",subLabel:"Background Color for Deleted Message, similiar to Mention but Customizeable"}];let L=[{version:"v0.0.8",patch:["Added Customizeable Text Color for Deleted Messages.","Added Customizeable Background Color for Deleted Messages. Like Mentions","Changed Deleted Message Patch.","Fixed needing to click multiple times to dismiss a message.","Removed Option to use DELETED, NormalEphemeral, DefaultAutomodEphemeral","Removed Ephemeral Custom Settings."]}];function $(){return I.useProxy(l.storage),t.React.createElement(B,null,t.React.createElement(h,{style:{marginTop:20}},t.React.createElement(h,{style:{marginTop:10}},t.React.createElement(u,{style:[r.text,r.optionText]},F("Customize")),t.React.createElement(h,{style:[r.subText]},v.map(function(e,s){return t.React.createElement(t.React.Fragment,null,t.React.createElement(k,{title:e.title,keyboardType:e.type,placeholder:e.placeholder,value:l.storage[e.id]??e.placeholder,onChange:function(i){return l.storage[e.id]=i.toString()}}),s!==v.length-1&&t.React.createElement(_,null))})),t.React.createElement(h,{style:[r.subText]},A.map(function(e,s){return t.React.createElement(t.React.Fragment,null,t.React.createElement(b,{label:e.label,subLabel:e.subLabel,leading:e.icon&&t.React.createElement(b.Icon,{source:O.getAssetIDByName(e.icon)}),trailing:"id"in e?t.React.createElement(P,{value:l.storage[e.id]??e.default,onValueChange:function(i){return l.storage[e.id]=i}}):void 0}),s!==A.length-1&&t.React.createElement(_,null))})),t.React.createElement(u,{style:[r.subText,r.optionText]},F("Reload the Plugin to Apply Color Change")),t.React.createElement(u,{style:[r.text,r.optionText]},"Changes"),L.map(function(e,s){return t.React.createElement(t.React.Fragment,null,t.React.createElement(u,{style:[r.text]},e.version||"Dev Version"),e.patch?.map(function(i){return t.React.createElement(t.React.Fragment,null,t.React.createElement(u,{style:[r.subText]},`- ${i}`))}))}))))}const w=D.findByProps("startEditMessage"),x=D.findByProps("getMessage","getMessages"),R=D.findByProps("getChannel","getDMFromUserId"),{DCDChatManager:z}=t.ReactNative.NativeModules;let E=[];const U={onLoad(){this.self=y.before("startEditMessage",w,function(e){let s=l.storage.editedMessage||"`[ EDITED ]`";s=s+`

`;const[i,a,o]=e,n=o.split(s);return e[2]=n[n.length-1],e}),this.messageLogger=y.before("dispatch",t.FluxDispatcher,function(e){const[s]=e;let i=s.type;if(i==="MESSAGE_DELETE"){const a=x.getMessage(s?.channelId,s?.id);return s.hasOwnProperty("guildId")?a?.flags==64?(e[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:a,optimistic:!1,sendMessageOptions:{},isPushNotification:!1},e):(e[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:{...a,flags:64,content:`${a?.content} `,channel_id:a?.channel_id,guild_id:R?.getChannel(a?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},E.push(s?.id),e):(E.includes(s.id)||(e[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:{...a,flags:64,content:`${a?.content} `,channel_id:a?.channel_id,guild_id:R?.getChannel(a?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},E.push(s?.id)),e)}if(i==="MESSAGE_UPDATE"){const a=x.getMessage(s?.message?.channel_id,s?.message?.id);let o=l.storage.editedMessage||"`[ EDITED ]`";if(o=o+`

`,e[0].message?.author?.bot||a?.author?.bot||!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||s?.message?.content==a.content)return e;let n=s?.message??a;return e[0]={type:"MESSAGE_UPDATE",message:{...n,content:`${a?.content}  ${o}${s?.message?.content??""}`,guild_id:R.getChannel(a?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},e}}),this.colorText=y.before("updateRows",z,function(e){let s=JSON.parse(e[1]),i=l.storage.deletedMessageColor||"E40303",a=/[0-9A-Fa-f]{6}/;i.match(a)||(i="E40303");function o(n){const p=["text","heading","s","u","em","strong","list","blockQuote"];if(Array.isArray(n))return n.map(o);if(typeof n=="object"&&n!==null){const{content:d,type:c,target:f,context:J,items:m}=n;if(!p.includes(c))return n;if(c==="text"&&d&&d.length>=1)return{content:[{content:d,type:"text"}],target:"usernameOnClick",type:"link",context:{username:1,medium:!0,usernameOnClick:{action:"0",userId:"0",linkColor:t.ReactNative.processColor(`#${i.toString()}`),messageChannelId:"0"}}};const M=o(d),N=m?m.map(o):void 0;if(M!==d||N!==m||!p.includes(c)){const g={...n,content:M};return c==="blockQuote"&&f&&(g.content=M,g.target=f),c==="list"&&g.hasOwnProperty("content")&&delete g.content,m&&(g.items=N),g}}return n}s.forEach(function(n){if(n.type!=1)return;if(!E.includes(n?.message?.id))return n;let p=o(n?.message?.content);n.message.content=p,n.message.edited=l.storage.deletedMessage||"This message is deleted";let d=l.storage.deletedMessageColorBackground||"FF2C2F";d.match(a)||(d="FF2C2F");let c=`#${d.toString()}33`,f=`#${d.toString()}CC`;return Boolean(l.storage.useBackgroundColor)&&(n.backgroundHighlight={backgroundColor:t.ReactNative.processColor(c),gutterColor:t.ReactNative.processColor(f)}),n}),e[1]=JSON.stringify(s)})},onUnload(){this.self?.(),this.colorText?.(),this.messageLogger?.()},settings:$};return C.default=U,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
