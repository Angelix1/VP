(function(d,n,S,i,p,m,R,u,o){"use strict";const{FormRow:h,FormSwitch:y,FormSwitchRow:P,FormSection:F,FormDivider:T}=m.Forms,{ScrollView:M,View:l,Text:b}=m.General,E=n.stylesheet.createThemedStyleSheet({text:{color:R.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:n.constants.Fonts.PRIMARY_BOLD,fontSize:12}}),f=[{label:"use DELETE",subLabel:"use [ DELETE ] instead of using ephemeral message",icon:"ic_edit_24px"}];function A(){n.React.useReducer(function(e){return~e},0);const[t,a]=n.React.useState(i.storage.useDelete);return S.useProxy(i.storage),n.React.createElement(M,null,n.React.createElement(l,{style:{marginTop:20}},n.React.createElement(l,{style:{marginTop:10}},n.React.createElement(b,{style:[E.text,E.optionText]},"Preferences".toUpperCase()),n.React.createElement(l,null,f.map(function(e,s){return n.React.createElement(n.React.Fragment,null,n.React.createElement(h,{label:e.label,subLabel:e.subLabel,leading:e.icon&&n.React.createElement(h.Icon,{source:p.getAssetIDByName(e.icon)}),trailing:n.React.createElement(y,{value:t,onValueChange:function(){i.storage.useDelete=!i.storage.useDelete,a(i.storage.useDelete)}})}),s!==f.length-1&&n.React.createElement(T,null))})))))}const _=o.findByProps("getMessage","getMessages"),g=o.findByProps("getChannel","getDMFromUserId"),v=o.findByProps("startEditMessage");let r={};function I(t,a){let{[t]:e,...s}=a;return s}const L={onLoad(){this.self=u.before("startEditMessage",v,function(t){let a=`${i.storage.edit_var||"`[ EDITED ]`"}

`;const[e,s,c]=t,D=c.split(a);return t[2]=D[D.length-1],t}),this.messageLogger=u.before("dispatch",n.FluxDispatcher,function(t){const[a]=t;if(a.type==="MESSAGE_DELETE"){if(r[a.id]&&r[a.id].modified==2)return r=I(a.id,r),t;if(r[a.id]&&r[a.id].modified==1)return r[a.id].modified=2,r[a.id].arg;if(!Boolean(i.storage.msg_useDeleted)&&!Boolean(i.storage.msg_normalEphemeral)){if(!a?.id||!a?.channelId)return;let s=i.storage.message?.trim?.()||"This message was deleted";return i.storage.useTimestamps&&(s+=` (${n.moment().format(i.storage.useAMPM?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),t[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:a.channelId,messageId:a.id}},errorResponseBody:{code:2e5,message:s}},r[a.id]={arg:t,modified:1},t}const e=_.getMessage(t[0].channelId,t[0].id);if(Boolean(i.storage.msg_useDeleted)==!0){let s=i.storage.del_var||"`[ DELETED ]`";return!e?.author?.id||!e?.author?.username||!e?.content&&e?.attachments?.length==0&&e?.embeds?.length==0||(t[0]={type:"MESSAGE_UPDATE",message:{...e,edited_timestamp:"invalid_timestamp",content:`${e?.content} ${s}`,guild_id:g.getChannel(e?.channel_id)?.guild_id}},r[a.id]={arg:t,modified:1}),t}if(Boolean(i.storage.msg_normalEphemeral)==!0)return!e?.author?.id||!e?.author?.username||!e?.content&&e?.attachments?.length==0&&e?.embeds?.length==0||(t[0]={type:"MESSAGE_UPDATE",channelId:e?.channel_id,message:{...e,content:e?.content,type:0,flags:64,channel_id:e?.channel_id,guild_id:g?.getChannel(e?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},r[a.id]={arg:t,modified:1}),t}if(a.type==="MESSAGE_UPDATE"){let e=`${i.storage.edit_var||"`[ EDITED ]`"}

`;const s=_.getMessage(t[0].message?.channel_id,t[0].message?.id);if(t[0].message?.author?.bot||s?.author?.bot||!s?.author?.id||!s?.author?.username||!s?.content&&s?.attachments?.length==0&&s?.embeds?.length==0||a?.message?.content==s.content)return t;let c=a?.message??s;return t[0]={type:"MESSAGE_UPDATE",message:{...c,content:`${s?.content}  ${e}${a?.message?.content??""}`,guild_id:g.getChannel(s?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},t}})},onUnload(){this.self?.(),this.messageLogger?.()},settings:A};return d.default=L,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
