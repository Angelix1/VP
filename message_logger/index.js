(function(v,s,B,C,d,e,u,g,P,ee,F){"use strict";var te=[{version:"v0.0.810",patch:["Added remove edited log history when long press a message.","Fixed Message fails to logs. (lmk if persist).","Added Ignore user list, by UserID and Name."]},{version:"v0.0.8",patch:["Added Customizeable Text Color for Deleted Messages.","Added Customizeable Background Color for Deleted Messages.","Added Customization for Edited Messages Separator.","Added Fix for when editing a own message it only take the last edited history rather than everything."]}];const{ScrollView:ae,View:L,Text:re,TouchableOpacity:k,TextInput:Me,Image:ne,Animated:w}=C.General,{FormLabel:se,FormArrow:xe,FormRow:S,FormSwitch:V,FormSwitchRow:Ue,FormSection:Y,FormDivider:oe,FormInput:H}=C.Forms;u.findByName("Icon");const ie=u.findByName("useIsFocused");u.findByProps("BottomSheetScrollView");const G=u.findByStoreName("UserStore"),j=u.findByProps("showUserProfile");d.getAssetIDByName("ic_add_24px"),d.getAssetIDByName("ic_arrow"),d.getAssetIDByName("ic_minus_circle_24px"),d.getAssetIDByName("Check"),d.getAssetIDByName("Small");const R=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3%",fontSize:24},sub:{color:g.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},image:{width:75,height:75,borderRadius:10,shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},mainText:{opacity:.975,letterSpacing:.25},header:{color:g.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:g.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function X(n){let{index:r}=n,t=s.storage?.users[r];B.useProxy(s.storage);const a=e.React.useRef(new w.Value(1)).current,i=function(){return w.spring(a,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},o=function(){return w.spring(a,{toValue:1,duration:250,useNativeDriver:!0}).start()},h={transform:[{scale:a}]};let l=G.getUser(t?.id),f=Object.values(G.getUsers());l||(l=f.find(function(c){return c?.username==t?.username})),l||(l=f.find(function(c){return c?.username?.toLowerCase()==t?.username?.toLowerCase()}));const y=e.NavigationNative.useNavigation();return ie(),e.React.createElement(e.React.Fragment,null,e.React.createElement(ae,null,e.React.createElement(Y,{style:[R.basicPad]},e.React.createElement(L,{style:[R.basicPad,R.sub]},e.React.createElement(Y,{title:"User Setting",style:[R.header]},e.React.createElement(S,{label:"Find User Id or Username",leading:e.React.createElement(S.Icon,{source:d.getAssetIDByName("ic_search")}),onPress:function(){l&&!t.username?.length?t.username=l.username:l&&!t.id?.length?t.id=l.id:P.showToast("Cannot find User Id/Username.")}}),e.React.createElement(H,{title:"User Username | Case Sensitive",placeholder:"Missing No",value:t?.username,onChange:function(c){return t.username=c}}),e.React.createElement(H,{title:"User Id",placeholder:"Missing No",value:t?.id,onChange:function(c){return t.id=c}}),e.React.createElement(S,{label:"User is webhook?",subLabel:"User is webhook or system, and not BOT or Normal User.",leading:e.React.createElement(S.Icon,{source:d.getAssetIDByName("ic_webhook_24px")}),trailing:e.React.createElement(V,{value:t?.isWebhook||!1,onValueChange:function(c){return t.isWebhook=c}})})),l&&e.React.createElement(S,{label:"Show User Profile",leading:e.React.createElement(S.Icon,{source:d.getAssetIDByName("ic_info")}),trailing:e.React.createElement(V,{value:t?.showUser||!1,onValueChange:function(c){return t.showUser=c}})}),t?.showUser&&e.React.createElement(L,{style:[R.container,{paddingBottom:10}]},e.React.createElement(k,{onPress:function(){return j.showUserProfile?.({userId:l?.id})},onPressIn:i,onPressOut:o},e.React.createElement(w.View,{style:h},e.React.createElement(ne,{style:[R.image],source:function(){let c=l?.getAvatarURL?.()?.replace?.("webp","png");return c||(c="https://cdn.discordapp.com/embed/avatars/1.png?size=300"),{uri:c}}}))),e.React.createElement(L,{style:R.textContainer},e.React.createElement(k,{onPress:function(){return j.showUserProfile({userId:l?.id})}},e.React.createElement(re,{style:[R.mainText,R.header]},l?.username||t?.username||"No Name"))),e.React.createElement(oe,null)))),e.React.createElement(S,{label:e.React.createElement(se,{text:"Remove User from Ignore List",style:{color:g.rawColors.RED_400}}),onPress:function(){y.pop(),s.storage.users?.splice(r,1)}})))}const{ScrollView:le,View:ce,Text:Oe,TouchableOpacity:de,TextInput:ue}=C.General,{FormLabel:$e,FormArrow:ge,FormRow:M,FormSwitch:ze,FormSwitchRow:ke,FormSection:he,FormDivider:fe,FormInput:Ve}=C.Forms,Ee=u.findByName("Icon"),Re=u.findByName("useIsFocused");u.findByProps("BottomSheetScrollView");const{getUser:me}=u.findByProps("getUser"),ye=d.getAssetIDByName("ic_add_24px");d.getAssetIDByName("ic_arrow"),d.getAssetIDByName("ic_minus_circle_24px"),d.getAssetIDByName("Check"),d.getAssetIDByName("Small");const pe=d.getAssetIDByName("ic_trash_24px"),A=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3.5%",fontSize:24},sub:{color:g.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:g.semanticColors.TEXT_NORMAL},placeholder:{color:g.semanticColors.INPUT_PLACEHOLDER_TEXT}});function Ce(){B.useProxy(s.storage);let[n,r]=React.useState("");const t=e.NavigationNative.useNavigation();Re();let a=s.storage.users??[];const i=function(){if(n){if(isNaN(parseInt(n)))a.push({id:void 0,username:n});else{let o=me(n);if(o)a.push({id:o?.id,username:"",showUser:!1,isWebhook:!1});else return P.showToast("Invalid User Id")}r(""),t.push("VendettaCustomPage",{title:"Adding User to Ignore List",render:function(){return React.createElement(X,{index:a?.length-1})}})}};return React.createElement(React.Fragment,null,React.createElement(le,{style:{flex:1}},React.createElement(he,{style:[A.header,A.basicPad]},React.createElement(ce,{style:[A.header,A.sub]},a.length>0&&React.createElement(M,{label:"Clear List",trailing:React.createElement(C.Forms.FormRow.Icon,{source:pe}),onPress:function(){a.length!==0&&ee.showConfirmationAlert({title:"Hol up, wait a minute!",content:`This will removes in total ${a.length} users from ignore list.`,confirmText:"Ye",cancelText:"Nah",confirmColor:"brand",onConfirm:function(){s.storage.users=[]}})}}),a?.map(function(o,h){return React.createElement(React.Fragment,null,React.createElement(M,{label:o?.username||o?.id||"No Data",trailing:React.createElement(ge,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Editing User",render:function(){return React.createElement(X,{index:h})}})}}),h!==a?.length-1&&React.createElement(fe,null))}),React.createElement(M,{label:React.createElement(ue,{value:n,onChangeText:r,placeholder:"User ID or Username",placeholderTextColor:A.placeholder.color,selectionColor:e.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:i,returnKeyType:"done",style:A.input}),trailing:React.createElement(de,{onPress:i},React.createElement(Ee,{source:ye}))})))))}const{ScrollView:Ie,View:N,Text:x,TouchableOpacity:Se,TextInput:Ye}=C.General,{FormLabel:He,FormArrow:Ge,FormRow:D,FormSwitch:U,FormSwitchRow:je,FormSection:O,FormDivider:J,FormInput:De}=C.Forms,m=e.stylesheet.createThemedStyleSheet({text:{color:g.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:g.semanticColors.TEXT_POSITIVE,paddingLeft:"6%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,fontSize:12},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:g.semanticColors.TEXT_NORMAL},placeholder:{color:g.semanticColors.INPUT_PLACEHOLDER_TEXT}}),be=u.findByName("Icon"),Ae=d.getAssetIDByName("ic_add_24px");u.findByProps("getUser");const Fe=u.findByName("useIsFocused");let _e=function(n){return n.toUpperCase()},W=[{id:"deletedMessageColor",title:"Customize Deleted Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"E40303"},{id:"deletedMessage",title:"Customize Deleted Message",type:"default",placeholder:"This message is deleted"},{id:"editedMessage",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"},{id:"deletedMessageColorBackground",title:"Customize Deleted Background Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"FF2C2F"}];const Q=[{id:"useBackgroundColor",default:!1,label:"Enable Background Color",subLabel:"Background Color for Deleted Message, similiar to Mention but Customizeable"},{id:"ignoreBots",default:!1,label:"Ignore Bots",subLabel:"Ignore bot deleted messages."}];function we(){B.useProxy(s.storage);const n=e.NavigationNative.useNavigation();Fe(),s.storage.users;const r=function(){n.push("VendettaCustomPage",{title:"List of Ignored Users",render:function(){return e.React.createElement(Ce,null)}})};return e.React.createElement(Ie,null,e.React.createElement(N,{style:{marginTop:20,marginBottom:20}},e.React.createElement(O,{title:"Plugin Setting",style:[m.header]},e.React.createElement(D,{label:"Customization",subLabel:"Show customization for the plugin",leading:e.React.createElement(D.Icon,{source:d.getAssetIDByName("ic_category_16px")}),trailing:e.React.createElement(U,{value:s.storage.customize??!1,onValueChange:function(t){return s.storage.customize=t}})}),s.storage.customize&&e.React.createElement(N,{style:[m.subText]},W.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(De,{title:t.title,keyboardType:t.type,placeholder:t.placeholder,value:s.storage[t.id]??t.placeholder,onChange:function(i){return s.storage[t.id]=i.toString()}}),a!==W.length-1&&e.React.createElement(J,null))})),s.storage.customize&&e.React.createElement(N,{style:[m.subText]},Q.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(D,{label:t.label,subLabel:t.subLabel,leading:t.icon&&e.React.createElement(D.Icon,{source:d.getAssetIDByName(t.icon)}),trailing:"id"in t?e.React.createElement(U,{value:s.storage[t.id]??t.default,onValueChange:function(i){return s.storage[t.id]=i}}):void 0}),a!==Q.length-1&&e.React.createElement(J,null))})),s.storage.customize&&e.React.createElement(x,{style:[m.subText,m.optionText]},_e("Reload the Plugin to Apply Color Change"))),e.React.createElement(O,{title:"Ignore List Setting",style:[m.header]},e.React.createElement(N,{style:{color:g.semanticColors.TEXT_POSITIVE,paddingLeft:"8%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,fontSize:12}},e.React.createElement(D,{label:"Add User to List",onPress:r,trailing:e.React.createElement(Se,{onPress:r},e.React.createElement(be,{source:Ae}))}))),e.React.createElement(O,{title:"Plugin Updates",style:[m.header]},e.React.createElement(D,{label:"Show Changes",subLabel:"Show New stuff, Fixes, etc for the plugin",leading:e.React.createElement(D.Icon,{source:d.getAssetIDByName("ic_info")}),trailing:e.React.createElement(U,{value:s.storage.showChanges??!1,onValueChange:function(t){return s.storage.showChanges=t}})}),s.storage.showChanges&&te?.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(x,{style:[m.text]},t.version||"Dev Version"),t.patch?.map(function(i){return e.React.createElement(e.React.Fragment,null,e.React.createElement(x,{style:[m.subText]},`- ${i}`))}))}))))}const Ne=u.findByProps("startEditMessage"),$=u.findByProps("getMessage","getMessages"),z=u.findByProps("getChannel","getDMFromUserId"),K=u.findByProps("openLazy","hideActionSheet");u.findByProps("getUser");const Te=u.findByName("Icon"),{DCDChatManager:ve}=e.ReactNative.NativeModules,{FormRow:Be}=C.Forms;function Pe(n,r){let{[n]:t,...a}=r;return a}let E={},T=[];function q(n,r){if(n!=null&&r!=null)for(const t of Object.keys(r))typeof r[t]=="object"&&!Array.isArray(r[t])?(typeof n[t]!="object"&&(n[t]={}),q(n[t],r[t])):n[t]??=r[t]}q(s.storage,{deletedMessage:void 0,editedMessage:void 0,deletedMessageColorBackground:void 0,useBackgroundColor:!1,customize:!1,showChanges:!1,ignore:!1,ignoreBots:!1,users:[]});const Le={onLoad(){this.self=F.before("startEditMessage",Ne,function(n){let r=s.storage.editedMessage||"`[ EDITED ]`";r=r+`

`;const[t,a,i]=n,o=i.split(r);return n[2]=o[o.length-1],n}),this.messageLogger=F.before("dispatch",e.FluxDispatcher,function(n){const[r]=n;let t=r.type;if(t==="MESSAGE_DELETE"){if(E[r.id]&&E[r.id].modified==2)return E=Pe(r.id,E),n;if(E[r.id]&&E[r.id].modified==1)return E[r.id].modified=2,E[r.id].arg;const a=$.getMessage(n[0].channelId,n[0].id);return s.storage?.ignoreBots&&a?.author?.bot||s.storage?.users?.some(function(i){return i?.id==a?.author?.id})||s.storage?.users?.some(function(i){return i?.username==a?.author?.username})||!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||(n[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:{...a,content:a?.content,type:0,flags:64,channel_id:a?.channel_id,guild_id:z?.getChannel(a?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},E[r.id]={arg:n,modified:1}),n}if(t==="MESSAGE_UPDATE"){if(r?.removeHistory||s.storage?.ignoreBots&&r?.message?.author?.bot||s.storage?.users?.some(function(h){return h?.id==r?.message?.author?.id})||s.storage?.users?.some(function(h){return h?.username==r?.message?.author?.username}))return n;const a=$.getMessage(r?.message?.channel_id,r?.message?.id);let i=s.storage.editedMessage||"`[ EDITED ]`";if(i=i+`

`,n[0].message?.author?.bot||a?.author?.bot||!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||r?.message?.content==a?.content)return n;let o=r?.message||a;return n[0]={type:"MESSAGE_UPDATE",message:{...o,content:`${a?.content}  ${i}${r?.message?.content??""}`,guild_id:z.getChannel(a?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},T.push(a?.id||r?.message?.id),n}return n}),this.colorText=F.before("updateRows",ve,function(n){let r=JSON.parse(n[1]),t=s.storage.deletedMessageColor||"E40303",a=/[0-9A-Fa-f]{6}/;t.match(a)||(t="E40303");function i(o){const h=["text","heading","s","u","em","strong","list","blockQuote"];if(Array.isArray(o))return o.map(i);if(typeof o=="object"&&o!==null){const{content:l,type:f,target:y,context:c,items:p}=o;if(!h.includes(f))return o;if(f==="text"&&l&&l.length>=1)return{content:[{content:l,type:"text"}],target:"usernameOnClick",type:"link",context:{username:1,medium:!0,usernameOnClick:{action:"0",userId:"0",linkColor:e.ReactNative.processColor(`#${t.toString()}`),messageChannelId:"0"}}};const b=i(l),_=p?p.map(i):void 0;if(b!==l||_!==p||!h.includes(f)){const I={...o,content:b};return f==="blockQuote"&&y&&(I.content=b,I.target=y),f==="list"&&I.hasOwnProperty("content")&&delete I.content,p&&(I.items=_),I}}return o}return r.forEach(function(o){if(o?.type==1&&E[o?.message?.id]){let h=i(o?.message?.content);o.message.content=h,o.message.edited=s.storage.deletedMessage||"This message is deleted";let l=s.storage.deletedMessageColorBackground||"FF2C2F";l.match(a)||(l="FF2C2F");let f=`#${l.toString()}33`,y=`#${l.toString()}CC`;Boolean(s.storage.useBackgroundColor)&&(o.backgroundHighlight={backgroundColor:e.ReactNative.processColor(f),gutterColor:e.ReactNative.processColor(y)})}}),n[1]=JSON.stringify(r),n}),this.removeEditedHistory=F.before("openLazy",K,function(n){const[r,t,a]=n;t==="MessageLongPressActionSheet"&&r.then(function(i){const o=F.after("default",i,function(h,l){e.React.useEffect(function(){return function(){o()}},[]);let[f,y]=l.props?.children?.props?.children?.props?.children;const c=f?.props?.message??a?.message;if(!y||!c)return;const p=$.getMessage(c.channel_id,c.id);T.includes(c?.id||p?.id)&&y.unshift(e.React.createElement(Be,{label:"Remove EDITED Log History",leading:e.React.createElement(Te,{source:d.getAssetIDByName("ic_edit_24px")}),onPress:function(){let b=s.storage.editedMessage||"`[ EDITED ]`";b=b+`

`;const _=c?.content?.split(b),I=_[_.length-1];e.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...p,content:`${I}`,guild_id:z.getChannel(p.channel_id).guild_id},removeHistory:!0});let Z=T.indexOf(p?.id||c?.id);Z>-1&&T.splice(Z,1),K.hideActionSheet(),P.showToast("[Message Logger] Logs Removed",d.getAssetIDByName("ic_edit_24px"))}}))})})})},onUnload(){this.self?.(),this.colorText?.(),this.messageLogger?.(),this.removeEditedHistory?.()},settings:we};return v.default=Le,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.ui.assets,vendetta.metro.common,vendetta.metro,vendetta.ui,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.patcher);
