(function(l,s,D,i,S,u,y,m,c){"use strict";const{FormRow:h,FormSwitch:R,FormSwitchRow:$,FormSection:B,FormDivider:b}=u.Forms,{ScrollView:T,View:o,Text:M}=u.General,f=s.stylesheet.createThemedStyleSheet({text:{color:y.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:s.constants.Fonts.PRIMARY_BOLD,fontSize:12}}),E=[{label:"use DELETE",subLabel:"use [ DELETE ] instead of using ephemeral message",icon:"ic_edit_24px"}];function v(){s.React.useReducer(function(e){return~e},0);const[t,n]=s.React.useState(i.storage.useDelete);return D.useProxy(i.storage),s.React.createElement(T,null,s.React.createElement(o,{style:{marginTop:20}},s.React.createElement(o,{style:{marginTop:10}},s.React.createElement(M,{style:[f.text,f.optionText]},"Preferences".toUpperCase()),s.React.createElement(o,null,E.map(function(e,r){return s.React.createElement(s.React.Fragment,null,s.React.createElement(h,{label:e.label,subLabel:e.subLabel,leading:e.icon&&s.React.createElement(h.Icon,{source:S.getAssetIDByName(e.icon)}),trailing:s.React.createElement(R,{value:t,onValueChange:function(){i.storage.useDelete=!i.storage.useDelete,n(i.storage.useDelete)}})}),r!==E.length-1&&s.React.createElement(b,null))})))))}const _=c.findByProps("getMessage","getMessages"),g=c.findByProps("getChannel","getDMFromUserId"),A=c.findByProps("startEditMessage");let a={},p="`[ EDITED ]`\n\n",L="`[ DELETED ]`";function P(t,n){let{[t]:e,...r}=n;return r}const F={onLoad(){this.self=m.before("startEditMessage",A,function(t){const[n,e,r]=t,d=r.split(p);return t[2]=d[d.length-1],t}),this.messageLogger=m.before("dispatch",s.FluxDispatcher,function(t){i.storage.useDelete??=!1;const[n]=t;if(n.type==="MESSAGE_DELETE"){const e=_.getMessage(t[0].channelId,t[0].id);if(a[n.id]&&a[n.id].modified==2)return a=P(n.id,a),t;if(a[n.id]&&a[n.id].modified==1)return a[n.id].modified=2,a[n.id].arg;if(Boolean(i.storage.useDelete)==!1)return!e?.author?.id||!e?.author?.username||!e?.content&&e?.attachments?.length==0&&e?.embeds?.length==0||(t[0]={type:"MESSAGE_UPDATE",channelId:e?.channel_id,message:{id:e?.id,type:0,flags:64,content:e?.content.toString(),channel_id:e?.channel_id,guild_id:g.getChannel(e?.channel_id)?.guild_id,author:e?.author,attachments:e?.attachments,embeds:e?.embeds,message_reference:e?.message_reference??{},pinned:!1,mentions:[],mention_channels:[],mention_roles:[],mention_everyone:!1,timestamp:`${new Date().toJSON()}`,state:"SENT",tts:!1},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},a[n.id]={arg:t,modified:1}),t;if(Boolean(i.storage.useDelete)==!0)return t[0]={type:"MESSAGE_UPDATE",message:{...e,edited_timestamp:"invalid_timestamp",content:`${e?.content} ${L}`,guild_id:g.getChannel(e?.channel_id)?.guild_id,message_reference:e?.message_reference??{}},log_edit:!1},a[n.id]={arg:t,modified:1},t}if(n.type==="MESSAGE_UPDATE"){if(t[0].message?.author?.bot)return t;const e=_.getMessage(t[0].message?.channel_id,t[0].message?.id);if(!e?.author?.id||!e?.author?.username||!e?.content&&e?.attachments?.length==0&&e?.embeds?.length==0)return t;const r=n?.message?.message_reference!=null?n?.message?.message_reference:e?.message_reference;return n?.message?.embeds.some(function(d){return e?.content?.includes(d?.url)})||(t[0]={type:"MESSAGE_UPDATE",message:{...e,type:e?.type,flags:e?.flags,message_reference:r,attachments:n?.message?.attachments??[],embeds:n?.message?.embeds??[],edited_timestamp:"invalid_timestamp",content:`${e?.content}  ${p}${n?.message?.content??""}`,guild_id:g.getChannel(e?.channel_id)?.guild_id},log_edit:!1}),t}})},onUnload(){this.self?.(),this.messageLogger?.()},settings:v};return l.default=F,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
