(function(N,s,B,C,u,e,f,g,M,ie,I,oe){"use strict";var le=[{version:"End Of Life (NO MAJOR UPDATE)",patch:["This plugin will not be updated anymore in term MAJOR UPDATE, until further infos."]},{version:"v0.1.3",patch:["Fixed Crashing Issue when Embedded Links got Sent on Chat","Fixed Crashing Issue When Long Press a Message","Fixed Crashing Issue when Opening Plugin Settings"]},{version:"v0.0.8 - v0.0.82",patch:["Added minimalistic option","Added remove edited log history when long press a message.","Added Ignore user list, by UserID and Name.","Added Customizeable Text Color for Deleted Messages.","Added Customizeable Background Color for Deleted Messages.","Added Customization for Edited Messages Separator.","Fixed for when editing a own message it only take the last edited history rather than everything.","Fixed Message fails to logs. (lmk if persist)."]}];const{ScrollView:ce,View:L,Text:de,TouchableOpacity:V,TextInput:ze,Image:ue,Animated:F}=C.General,{FormLabel:ge,FormIcon:he,FormArrow:Ve,FormRow:w,FormSwitch:Y,FormSwitchRow:Ye,FormSection:H,FormDivider:fe,FormInput:G}=C.Forms,Ee=f.findByName("useIsFocused");f.findByProps("BottomSheetScrollView");const X=f.findByStoreName("UserStore"),j=f.findByProps("showUserProfile");u.getAssetIDByName("ic_add_24px"),u.getAssetIDByName("ic_arrow"),u.getAssetIDByName("ic_minus_circle_24px"),u.getAssetIDByName("Check"),u.getAssetIDByName("Small");function x(r){return e.React.createElement(he,{style:{opacity:1},source:u.getAssetIDByName(r)})}const R=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3%",fontSize:24},sub:{color:g.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},image:{width:75,height:75,borderRadius:10,shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},mainText:{opacity:.975,letterSpacing:.25},header:{color:g.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:g.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function J(r){let{index:n}=r,t=s.storage?.users[n];B.useProxy(s.storage);const a=e.React.useRef(new F.Value(1)).current,o=function(){return F.spring(a,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},i=function(){return F.spring(a,{toValue:1,duration:250,useNativeDriver:!0}).start()},h={transform:[{scale:a}]};let l=X.getUser(t?.id),c=Object.values(X.getUsers());l||(l=c.find(function(d){return d?.username==t?.username})),l||(l=c.find(function(d){return d?.username?.toLowerCase()==t?.username?.toLowerCase()}));const y=e.NavigationNative.useNavigation();return Ee(),e.React.createElement(e.React.Fragment,null,e.React.createElement(ce,null,e.React.createElement(H,{style:[R.basicPad]},e.React.createElement(L,{style:[R.basicPad,R.sub]},e.React.createElement(H,{title:"User Setting",style:[R.header]},e.React.createElement(w,{label:"Find User Id or Username",leading:x("ic_search"),onPress:function(){l&&!t.username?.length?t.username=l.username:l&&!t.id?.length?t.id=l.id:M.showToast("Cannot find User Id/Username.")}}),e.React.createElement(G,{title:"User Username | Case Sensitive",placeholder:"Missing No",value:t?.username,onChange:function(d){return t.username=d}}),e.React.createElement(G,{title:"User Id",placeholder:"Missing No",value:t?.id,onChange:function(d){return t.id=d}}),e.React.createElement(w,{label:"User is webhook?",subLabel:"User is webhook or system, and not BOT or Normal User.",leading:x("ic_webhook_24px"),trailing:e.React.createElement(Y,{value:t?.isWebhook||!1,onValueChange:function(d){return t.isWebhook=d}})})),l&&e.React.createElement(w,{label:"Show User Profile",leading:x("ic_info"),trailing:e.React.createElement(Y,{value:t?.showUser||!1,onValueChange:function(d){return t.showUser=d}})}),t?.showUser&&e.React.createElement(L,{style:[R.container,{paddingBottom:10}]},e.React.createElement(V,{onPress:function(){return j.showUserProfile?.({userId:l?.id})},onPressIn:o,onPressOut:i},e.React.createElement(F.View,{style:h},e.React.createElement(ue,{style:[R.image],source:function(){let d=l?.getAvatarURL?.()?.replace?.("webp","png");return d||(d="https://cdn.discordapp.com/embed/avatars/1.png"),{uri:d}}}))),e.React.createElement(L,{style:R.textContainer},e.React.createElement(V,{onPress:function(){return j.showUserProfile({userId:l?.id})}},e.React.createElement(de,{style:[R.mainText,R.header]},l?.username||t?.username||"No Name"))),e.React.createElement(fe,null)))),e.React.createElement(w,{label:e.React.createElement(ge,{text:"Remove User from Ignore List",style:{color:g.rawColors.RED_400}}),onPress:function(){y.pop(),s.storage.users?.splice(n,1)}})))}const{ScrollView:me,View:Re,Text:He,TouchableOpacity:ye,TextInput:pe}=C.General,{FormLabel:Ge,FormIcon:Ce,FormArrow:be,FormRow:O,FormSwitch:Xe,FormSwitchRow:je,FormSection:Se,FormDivider:De,FormInput:Je}=C.Forms;function W(r,n){return React.createElement(Ce,{style:{opacity:1},source:n?r:u.getAssetIDByName(r)})}const Ie=f.findByName("useIsFocused");f.findByProps("BottomSheetScrollView");const{getUser:Ae}=f.findByProps("getUser"),Fe=u.getAssetIDByName("ic_add_24px");u.getAssetIDByName("ic_arrow"),u.getAssetIDByName("ic_minus_circle_24px"),u.getAssetIDByName("Check"),u.getAssetIDByName("Small");const we=u.getAssetIDByName("ic_trash_24px"),S=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3.5%",fontSize:24},sub:{color:g.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:g.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:g.semanticColors.TEXT_NORMAL},placeholder:{color:g.semanticColors.INPUT_PLACEHOLDER_TEXT}});function _e(){B.useProxy(s.storage);let[r,n]=React.useState("");const t=e.NavigationNative.useNavigation();Ie();let a=s.storage.users??[];const o=function(){if(r){if(isNaN(parseInt(r)))a.push({id:void 0,username:r});else{let i=Ae(r);if(i)a.push({id:i?.id,username:"",showUser:!1,isWebhook:!1});else return M.showToast("Invalid User Id")}n(""),t.push("VendettaCustomPage",{title:"Adding User to Ignore List",render:function(){return React.createElement(J,{index:a?.length-1})}})}};return React.createElement(React.Fragment,null,React.createElement(me,{style:{flex:1}},React.createElement(Se,{style:[S.header,S.basicPad]},React.createElement(Re,{style:[S.header,S.sub]},a.length>0&&React.createElement(O,{label:"Clear List",trailing:W(we,!0),onPress:function(){a.length!==0&&ie.showConfirmationAlert({title:"Hol up, wait a minute!",content:`This will removes in total ${a.length} users from ignore list.`,confirmText:"Ye",cancelText:"Nah",confirmColor:"brand",onConfirm:function(){s.storage.users=[]}})}}),a?.map(function(i,h){return React.createElement(React.Fragment,null,React.createElement(O,{label:i?.username||i?.id||"No Data",trailing:React.createElement(be,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Editing User",render:function(){return React.createElement(J,{index:h})}})}}),h!==a?.length-1&&React.createElement(De,null))}),React.createElement(O,{label:React.createElement(pe,{value:r,onChangeText:n,placeholder:"User ID or Username",placeholderTextColor:S.placeholder.color,selectionColor:e.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:o,returnKeyType:"done",style:S.input}),trailing:React.createElement(ye,{onPress:o},W(Fe,!0))})))))}const{ScrollView:Te,View:_,Text:Q,TouchableOpacity:ve,TextInput:We}=C.General,{FormLabel:Qe,FormIcon:T,FormArrow:Ke,FormRow:A,FormSwitch:U,FormSwitchRow:qe,FormSection:$,FormDivider:K,FormInput:Pe}=C.Forms,b=e.stylesheet.createThemedStyleSheet({text:{color:g.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:g.semanticColors.TEXT_POSITIVE,paddingLeft:"6%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,fontSize:12},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:g.semanticColors.TEXT_NORMAL},placeholder:{color:g.semanticColors.INPUT_PLACEHOLDER_TEXT}}),Ne=u.getAssetIDByName("ic_add_24px");f.findByProps("getUser");const Be=f.findByName("useIsFocused");let q=[{id:"deletedMessageColor",title:"Customize Deleted Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"E40303"},{id:"deletedMessage",title:"Customize Deleted Message",type:"default",placeholder:"This message is deleted"},{id:"editedMessage",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"},{id:"deletedMessageColorBackground",title:"Customize Deleted Background Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"FF2C2F"}];const Z=[{id:"minimal",default:!0,label:"Minimalistic Settings",subLabel:"Removes all Styling (Enabled by Default)"},{id:"useBackgroundColor",default:!1,label:"Enable Background Color",subLabel:"Background Color for Deleted Message, similiar to Mention but Customizeable"},{id:"ignoreBots",default:!1,label:"Ignore Bots",subLabel:"Ignore bot deleted messages."}];function Me(){B.useProxy(s.storage);const r=e.NavigationNative.useNavigation();Be(),s.storage.users;const n=function(){r.push("VendettaCustomPage",{title:"List of Ignored Users",render:function(){return e.React.createElement(_e,null)}})};return e.React.createElement(Te,null,e.React.createElement(_,{style:{marginTop:20,marginBottom:20}},e.React.createElement($,{title:"Plugin Setting",style:[b.header]},e.React.createElement(A,{label:"Customization",subLabel:"Show customization for the plugin",leading:e.React.createElement(T,{style:{opacity:1},source:u.getAssetIDByName("ic_category_16px")}),trailing:e.React.createElement(U,{value:s.storage.customize??!1,onValueChange:function(t){return s.storage.customize=t}})}),s.storage.customize&&e.React.createElement(A,{label:"Reload the Plugin to Apply Color Change"}),s.storage.customize&&e.React.createElement(_,{style:[b.subText]},Z.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(A,{label:t.label,subLabel:t.subLabel,leading:t.icon&&e.React.createElement(T,{style:{opacity:1},source:u.getAssetIDByName(t.icon)}),trailing:"id"in t?e.React.createElement(U,{value:s.storage[t.id]??t.default,onValueChange:function(o){return s.storage[t.id]=o}}):void 0}),a!==Z.length-1&&e.React.createElement(K,null))})),s.storage.customize&&e.React.createElement(_,{style:[b.subText]},q.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(Pe,{title:t.title,keyboardType:t.type,placeholder:t.placeholder,value:s.storage[t.id]??t.placeholder,onChange:function(o){return s.storage[t.id]=o.toString()}}),a!==q.length-1&&e.React.createElement(K,null))}))),e.React.createElement($,{title:"Ignore List Setting",style:[b.header]},e.React.createElement(_,{style:{color:g.semanticColors.TEXT_POSITIVE,paddingLeft:"8%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,fontSize:12}},e.React.createElement(A,{label:"Add User to List",onPress:n,trailing:e.React.createElement(ve,{onPress:n},e.React.createElement(T,{style:{opacity:1},source:Ne}))}))),e.React.createElement($,{title:"Plugin Updates",style:[b.header]},e.React.createElement(A,{label:"Show Changes",subLabel:"Show New stuff, Fixes, etc for the plugin",leading:e.React.createElement(T,{style:{opacity:1},source:u.getAssetIDByName("ic_info")}),trailing:e.React.createElement(U,{value:s.storage.showChanges??!1,onValueChange:function(t){return s.storage.showChanges=t}})}),s.storage.showChanges&&le?.map(function(t,a){return e.React.createElement(e.React.Fragment,null,e.React.createElement(Q,{style:[b.text]},t.version||"Dev Version"),t.patch?.map(function(o){return e.React.createElement(e.React.Fragment,null,e.React.createElement(Q,{style:[b.subText]},`- ${o}`))}))}))))}const Le=f.findByProps("startEditMessage"),k=f.findByProps("getMessage","getMessages"),z=f.findByProps("getChannel","getDMFromUserId"),ee=f.findByProps("openLazy","hideActionSheet");f.findByProps("getUser");const{DCDChatManager:xe}=e.ReactNative.NativeModules,{FormRow:Oe,FormIcon:Ue}=C.Forms;function $e(r,n){let{[r]:t,...a}=n;return a}let E={},v=[];function te(r,n){if(r!=null&&n!=null)for(const t of Object.keys(n))typeof n[t]=="object"&&!Array.isArray(n[t])?(typeof r[t]!="object"&&(r[t]={}),te(r[t],n[t])):r[t]??=n[t]}te(s.storage,{deletedMessage:void 0,editedMessage:void 0,deletedMessageColorBackground:void 0,useBackgroundColor:!1,customize:!1,showChanges:!1,ignore:!1,ignoreBots:!1,users:[],minimal:!0});let ae,ne,re,se;const ke={onLoad(){ae=I.before("startEditMessage",Le,function(r){let n=s.storage.editedMessage||"`[ EDITED ]`";n=n+`

`;const[t,a,o]=r,i=o.split(n);return r[2]=i[i.length-1],r}),ne=I.before("dispatch",e.FluxDispatcher,function(r){const[n]=r;let t=n.type;if(t==="MESSAGE_DELETE"){if(E[n.id]&&E[n.id].modified==2)return E=$e(n.id,E),r;if(E[n.id]&&E[n.id].modified==1)return E[n.id].modified=2,E[n.id].arg;if(s.storage?.ignoreBots&&a?.author?.bot)return r;const a=k.getMessage(n?.message?.channel_id||n?.channelId,n?.message?.id||n?.id);return!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||s.storage?.users?.length>0&&s.storage?.users?.some(function(o){return o?.id==a?.author?.id||o?.username==a?.author?.username})||(r[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:{...a,content:a?.content,type:0,flags:64,channel_id:a?.channel_id,guild_id:z?.getChannel(a?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},E[n.id]={arg:r,modified:1}),r}if(t==="MESSAGE_UPDATE"){if(n?.removeHistory)return r;const a=k.getMessage(n?.message?.channel_id||n?.channelId,n?.message?.id||n?.id);if(!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0)return r;const o=n?.message?.content==a?.content,i=n?.message?.embeds.some(function(c){return c?.url==a?.content||c?.thumbnail?.url==a?.content||a?.content.includes(c?.url)||a?.content.includes(c?.thumbnail?.url)});if(o||i||r[0].message?.author?.bot||a?.author?.bot||s.storage?.users?.length>0&&s.storage?.users?.some(function(c){return c?.id==a?.author?.id||c?.username==a?.author?.username}))return r;let h=s.storage.editedMessage||"`[ EDITED ]`";h=h+`

`;let l=n?.message||a;return r[0]={type:"MESSAGE_UPDATE",message:{...l,content:`${a?.content}  ${h}${n?.message?.content??""}`,guild_id:z.getChannel(a?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},v.push(a?.id||n?.message?.id),r}}),re=I.before("updateRows",xe,function(r){let n=JSON.parse(r[1]);if(!s.storage.minimal){let t=function(i){const h=["text","heading","s","u","em","strong","list","blockQuote"];if(Array.isArray(i))return i.map(t);if(typeof i=="object"&&i!==null){const{content:l,type:c,target:y,context:d,items:m}=i;if(!h.includes(c))return i;if(c==="text"&&l&&l.length>=1)return{content:[{content:l,type:"text"}],target:"usernameOnClick",type:"link",context:{username:1,medium:!0,usernameOnClick:{action:"0",userId:"0",linkColor:e.ReactNative.processColor(`#${a.toString()}`),messageChannelId:"0"}}};const D=t(l),P=m?m.map(t):void 0;if(D!==l||P!==m||!h.includes(c)){const p={...i,content:D};return c==="blockQuote"&&y&&(p.content=D,p.target=y),c==="list"&&p.hasOwnProperty("content")&&delete p.content,m&&(p.items=P),p}}return i},a=s.storage.deletedMessageColor||"E40303",o=/[0-9A-Fa-f]{6}/;a.match(o)||(a="E40303"),n.forEach(function(i){if(i?.type==1&&E[i?.message?.id]){let h=t(i?.message?.content);i.message.content=h,i.message.edited=s.storage.deletedMessage||"This message is deleted";let l=s.storage.deletedMessageColorBackground||"FF2C2F";l.match(o)||(l="FF2C2F");let c=`#${l.toString()}33`,y=`#${l.toString()}CC`;Boolean(s.storage.useBackgroundColor)&&(i.backgroundHighlight={backgroundColor:e.ReactNative.processColor(c),gutterColor:e.ReactNative.processColor(y)})}})}r[1]=JSON.stringify(n)}),se=I.before("openLazy",ee,function(r){let[n,t,a]=r;const o=a?.message;t!=="MessageLongPressActionSheet"||!o||n.then(function(i){const h=I.after("default",i,function(l,c){e.React.useEffect(function(){return function(){h()}},[]);const y=oe.findInReactTree(c,function(m){return m?.[0]?.type?.name==="ButtonRow"});if(!y)return c;const d=k.getMessage(o.channel_id,o.id);v.includes(o?.id||d?.id)&&y.unshift(e.React.createElement(Oe,{label:"Remove EDITED Log History",leading:e.React.createElement(Ue,{style:{opacity:1},source:u.getAssetIDByName("ic_edit_24px")}),onPress:function(){let m=s.storage.editedMessage||"`[ EDITED ]`";m=m+`

`;const D=o?.content?.split(m),P=D[D.length-1];e.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...d,content:`${P}`,guild_id:z.getChannel(d.channel_id).guild_id},removeHistory:!0});let p=v.indexOf(d?.id||o?.id);p>-1&&v.splice(p,1),ee.hideActionSheet(),M.showToast("[Message Logger] Logs Removed",u.getAssetIDByName("ic_edit_24px"))}}))})})})},onUnload(){ae?.(),re?.(),ne?.(),se?.()},settings:Me};return N.default=ke,Object.defineProperty(N,"__esModule",{value:!0}),N})({},vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.ui.assets,vendetta.metro.common,vendetta.metro,vendetta.ui,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.patcher,vendetta.utils);
