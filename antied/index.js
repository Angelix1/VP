(function(z,Ae,f,o,V,B,R,e,E,H,we,_,Ie){"use strict";const{openLazy:De,hideActionSheet:At}=f.findByProps("openLazy","hideActionSheet");function ee(a,r){if(a!=null&&r!=null)for(const t of Object.keys(r))typeof r[t]=="object"&&!Array.isArray(r[t])?(typeof a[t]!="object"&&(a[t]={}),ee(a[t],r[t])):a[t]??=r[t]}function Be(a,r){try{De(new Promise(function(t){return t({default:a})}),"ActionSheet",r)}catch(t){Ae.logger.error(t.stack),showToast("Got error when opening ActionSheet! Please check debug logs")}}const _e=function(a,r){return`${a}${Math.floor(r*255).toString(16).padStart(2,0)}`},Y={toInt(a){return a=a.replace(/^#/,""),parseInt(a,16)},toHex(a){return"#"+a.toString(16).toUpperCase()},HSLtoHEX(a,r,t){t/=100;const c=r*Math.min(t,1-t)/100,n=function(u){const s=(u+a/30)%12,l=t-c*Math.max(Math.min(s-3,9-s,1),-1);return Math.round(255*l).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}},{ScrollView:Fe,View:G,Text:Me,TouchableOpacity:te,TextInput:wt,Image:Pe,Animated:$}=B.General,{FormLabel:Te,FormIcon:Le,FormArrow:It,FormRow:j,FormSwitch:Ne,FormSwitchRow:Dt,FormSection:ve,FormDivider:$e,FormInput:ae}=B.Forms,xe=f.findByName("useIsFocused");f.findByProps("BottomSheetScrollView");const re=f.findByStoreName("UserStore"),ne=f.findByProps("showUserProfile");R.getAssetIDByName("ic_add_24px"),R.getAssetIDByName("ic_arrow"),R.getAssetIDByName("ic_minus_circle_24px"),R.getAssetIDByName("Check"),R.getAssetIDByName("Small");function se(a){return e.React.createElement(Le,{style:{opacity:1},source:R.getAssetIDByName(a)})}const M=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:E.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3%",fontSize:24},sub:{color:E.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:E.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},container:{marginTop:25,marginLeft:"5%",marginBottom:-15,flexDirection:"row"},textContainer:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap",shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},image:{width:75,height:75,borderRadius:10,shadowColor:"#000",shadowOffset:{width:1,height:4},shadowOpacity:.2,shadowRadius:4.65,elevation:8},mainText:{opacity:.975,letterSpacing:.25},header:{color:E.semanticColors.HEADER_PRIMARY,fontFamily:e.constants.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},subHeader:{color:E.semanticColors.HEADER_SECONDARY,fontSize:12.75}});function oe(a){let{index:r}=a;V.useProxy(o.storage);let t=o.storage?.inputs?.ignoredUserList[r];const c=e.React.useRef(new $.Value(1)).current,n=function(){return $.spring(c,{toValue:1.1,duration:10,useNativeDriver:!0}).start()},u=function(){return $.spring(c,{toValue:1,duration:250,useNativeDriver:!0}).start()},s={transform:[{scale:c}]};let l=re.getUser(t?.id),g=Object.values(re.getUsers());l||(l=g.find(function(p){return p?.username==t?.username})),l||(l=g.find(function(p){return p?.username?.toLowerCase()==t?.username?.toLowerCase()}));const C=e.NavigationNative.useNavigation();return xe(),e.React.createElement(e.React.Fragment,null,e.React.createElement(Fe,null,e.React.createElement(G,{style:[M.basicPad,M.sub]},e.React.createElement(ve,{title:"User Setting",style:[M.header]},e.React.createElement(j,{label:"Find User Id or Username",leading:se("ic_search"),onPress:function(){l&&!t.username?.length?t.username=l.username:l&&!t.id?.length?t.id=l.id:H.showToast("Cannot find User Id/Username.")}}),e.React.createElement(ae,{title:"User Username | Case Sensitive",placeholder:"Missing No",value:t?.username,onChange:function(p){return t.username=p}}),e.React.createElement(ae,{title:"User Id",placeholder:"Missing No",value:t?.id,onChange:function(p){return t.id=p}}),e.React.createElement(j,{label:"User is webhook?",subLabel:"User is webhook or system, and not BOT or Normal User.",leading:se("ic_webhook_24px"),trailing:e.React.createElement(Ne,{value:t?.isWebhook||!1,onValueChange:function(p){return t.isWebhook=p}})})),l&&e.React.createElement(G,{style:[M.container,{paddingBottom:10}]},e.React.createElement(te,{onPress:function(){return ne.showUserProfile?.({userId:l?.id})},onPressIn:n,onPressOut:u},e.React.createElement($.View,{style:s},e.React.createElement(Pe,{source:{uri:l?.getAvatarURL?.()?.replace?.("webp","png")||"https://cdn.discordapp.com/embed/avatars/2.png"},style:{width:128,height:128,borderRadius:10}}))),e.React.createElement(G,{style:M.textContainer},e.React.createElement(te,{onPress:function(){return ne.showUserProfile({userId:l?.id})}},e.React.createElement(Me,{style:[M.mainText,M.header]},l?.username||t?.username||"No Name"))),e.React.createElement($e,null)),e.React.createElement(j,{label:e.React.createElement(Te,{text:"Remove User from Ignore List",style:{color:E.rawColors.RED_400}}),onPress:function(){C.pop(),o.storage?.inputs?.ignoredUserList?.splice(r,1)}}))))}const{ScrollView:Ue,View:ke,Text:Bt,TouchableOpacity:Oe,TextInput:ze}=B.General,{FormLabel:_t,FormIcon:Ve,FormArrow:He,FormRow:X,FormSwitch:Ft,FormSwitchRow:Mt,FormSection:Ye,FormDivider:Ge,FormInput:Pt}=B.Forms;function ie(a,r){return React.createElement(Ve,{style:{opacity:1},source:r?a:R.getAssetIDByName(a)})}const je=f.findByName("useIsFocused");f.findByProps("BottomSheetScrollView");const{getUser:Xe}=f.findByProps("getUser"),Ke=R.getAssetIDByName("ic_add_24px");R.getAssetIDByName("ic_arrow"),R.getAssetIDByName("ic_minus_circle_24px"),R.getAssetIDByName("Check"),R.getAssetIDByName("Small");const Qe=R.getAssetIDByName("ic_trash_24px"),L=e.stylesheet.createThemedStyleSheet({basicPad:{paddingRight:10,marginBottom:10,letterSpacing:.25},header:{color:E.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"3.5%",fontSize:24},sub:{color:E.semanticColors.TEXT_POSITIVE,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,paddingLeft:"4%",fontSize:18},flagsText:{color:E.semanticColors.HEADER_SECONDARY,fontFamily:e.constants.Fonts.PRIMARY_BOLD,paddingLeft:"4%",fontSize:16},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:E.semanticColors.TEXT_NORMAL},placeholder:{color:E.semanticColors.INPUT_PLACEHOLDER_TEXT}});function Je(){V.useProxy(o.storage);let[a,r]=React.useState("");const t=e.NavigationNative.useNavigation();je();let c=o.storage?.inputs?.ignoredUserList??[];const n=function(){if(a){if(isNaN(parseInt(a)))c.push({id:void 0,username:a});else{let u=Xe(a);if(u)c.push({id:u?.id,username:"",showUser:!1,isWebhook:!1});else return H.showToast("Invalid User Id")}r(""),t.push("VendettaCustomPage",{title:"Adding User to Ignore List",render:function(){return React.createElement(oe,{index:c?.length-1})}})}};return React.createElement(React.Fragment,null,React.createElement(Ue,{style:{flex:1}},React.createElement(Ye,{style:[L.header,L.basicPad]},React.createElement(ke,{style:[L.header,L.sub]},c.length>0&&React.createElement(X,{label:"Clear List",trailing:ie(Qe,!0),onPress:function(){c.length!==0&&we.showConfirmationAlert({title:"Hol up, wait a minute!",content:`This will removes in total ${c.length} users from ignore list.`,confirmText:"Ye",cancelText:"Nah",confirmColor:"brand",onConfirm:function(){o.storage.inputs.ignoredUserList=[]}})}}),c?.map(function(u,s){return React.createElement(React.Fragment,null,React.createElement(X,{label:u?.username||u?.id||"No Data",trailing:React.createElement(He,null),onPress:function(){return t.push("VendettaCustomPage",{title:"Editing User",render:function(){return React.createElement(oe,{index:s})}})}}),s!==c?.length-1&&React.createElement(Ge,null))}),React.createElement(X,{label:React.createElement(ze,{value:a,onChangeText:r,placeholder:"User ID or Username",placeholderTextColor:L.placeholder.color,selectionColor:e.constants.Colors.PRIMARY_DARK_100,onSubmitEditing:n,returnKeyType:"done",style:L.input}),trailing:React.createElement(Oe,{onPress:n},ie(Ke,!0))})))))}const{StyleSheet:We,PanResponder:qe}=e.ReactNative,K=f.findByStoreName("ThemeStore"),{meta:{resolveSemanticColor:Q}}=f.findByProps("colors","meta"),{View:J}=B.General,{useState:Ze,useRef:et}=e.React,W={sliderOff:Q(K.theme,E.semanticColors.DEPRECATED_QUICKSWITCHER_INPUT_BACKGROUND),sliderOn:Q(K.theme,E.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND),thumb:Q(K.theme,E.semanticColors.MENTION_FOREGROUND)},le=function(a){let{onSlide:r,min:t,max:c,value:n}=a;const u=n||0,[s,l]=Ze(0),g=et(null);function C(d){g.current&&g.current.measure(function(h,i,b,m,y,A){let D=(d-y)/(b-y)*100;const k=Math.min(Math.max(0,Math.round(D/1)*1),100);r&&r(k)})}const p=e.React.useRef(qe.create({onStartShouldSetPanResponder:function(d,h){return!0},onStartShouldSetPanResponderCapture:function(d,h){return!0},onMoveShouldSetPanResponder:function(d,h){return!0},onMoveShouldSetPanResponderCapture:function(d,h){return!0},onPanResponderGrant:function(d,h){C(h.x0)},onPanResponderMove:function(d,h){C(h.moveX)},onPanResponderTerminationRequest:function(d,h){return!0},onPanResponderRelease:function(d,h){},onPanResponderTerminate:function(d,h){},onShouldBlockNativeResponder:function(d,h){return!0}})).current;function T(d){l(d.nativeEvent.layout.width)}const S=We.create({container:{marginLeft:"5%",width:"80%",height:20,borderRadius:25,backgroundColor:W.sliderOff,marginBottom:25},slid:{width:u+"%",height:"100%",borderTopLeftRadius:25,borderBottomLeftRadius:25,borderRadius:u===100?25:0,backgroundColor:W.sliderOn,justifyContent:"center"},thumb:{height:"150%",aspectRatio:1,alignSelf:"flex-end",right:-(s/2),borderRadius:100,backgroundColor:W.thumb}});return e.React.createElement(J,{style:S.container,...p.panHandlers,ref:g},e.React.createElement(J,{style:S.slid},e.React.createElement(J,{style:S.thumb,onLayout:T})))},tt=f.findByName("CustomColorPickerActionSheet"),{ScrollView:at,View:w,Text:ce,TouchableOpacity:de,TextInput:Tt,Pressable:Lt,Image:rt}=B.General,{FormLabel:Nt,FormIcon:x,FormArrow:vt,FormRow:P,FormSwitch:q,FormSwitchRow:$t,FormSection:v,FormDivider:F,FormInput:nt}=B.Forms,I=e.stylesheet.createThemedStyleSheet({text:{color:E.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:E.semanticColors.TEXT_POSITIVE,paddingLeft:"6%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:e.constants.Fonts.DISPLAY_NORMAL,fontSize:12},input:{fontSize:16,fontFamily:e.constants.Fonts.PRIMARY_MEDIUM,color:E.semanticColors.TEXT_NORMAL},placeholder:{color:E.semanticColors.INPUT_PLACEHOLDER_TEXT},container:{flex:1,justifyContent:"center",alignItems:"center"},colorPreview:{width:"75%",height:100,marginBottom:20},row:{flexDirection:"row",height:80,width:"90%",marginBottom:20},border:{borderRadius:12}}),st=R.getAssetIDByName("ic_add_24px");f.findByProps("getUser");const ot=f.findByName("useIsFocused"),ue=[{id:"minimalistic",default:!0,label:"Minimalistic Settings",subLabel:"Removes all Styling (Enabled by Default)"},{id:"useBackgroundColor",default:!1,label:"Enable Background Color",subLabel:"Background Color for Deleted Message, similiar to Mention but Customizeable"},{id:"ignoreBots",default:!1,label:"Ignore Bots",subLabel:"Ignore bot deleted messages."},{id:"removeDismissButton",default:!1,label:"Remove Dissmiss Message",subLabel:"Remove clickable Dismiss Message text from deleted ephemeral messages."},{id:"addTimestampForEdits",default:!1,label:"Add Edit Timestamp",subLabel:"Add Timestamp for edited messages."}],ge=[{id:"textColor",label:"Deleted Message Text Color",subLabel:"Click to customize Deleted Message Text Color",defaultColor:"#E40303"},{id:"backgroundColor",label:"Deleted Message Background Color",subLabel:"Click to customize Background Color",defaultColor:"#FF2C2F"},{id:"gutterColor",label:"Deleted Message Background Gutter Color",subLabel:"Click to customize Background Gutter Color",defaultColor:"#FF2C2F"}],fe=[{id:"deletedMessageBuffer",title:"Customize Deleted Message",type:"default",placeholder:"This message is deleted"},{id:"editedMessageBuffer",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"}];function U(a){if(a<0)return"00";if(a>100)return"FF";{const r=Math.round(a/100*255).toString(16);return r.length===1?`0${r}`:r}}function he(a){const r=parseInt(a,16);return isNaN(r)?0:Math.round(r/255*100)}function it(){V.useProxy(o.storage);const[a,r]=e.React.useState(he(o.storage?.colors?.backgroundColorAlpha)??100),[t,c]=e.React.useState(he(o.storage?.colors?.gutterColorAlpha)??100),n=e.NavigationNative.useNavigation();ot();const u=function(){n.push("VendettaCustomPage",{title:"List of Ignored Users",render:function(){return e.React.createElement(Je,null)}})};return e.React.createElement(at,null,e.React.createElement(w,{style:{marginTop:20,marginBottom:20}},e.React.createElement(v,{title:"Plugin Setting",style:[I.header]},e.React.createElement(P,{label:"Customization",subLabel:"Show customization for the plugin",leading:e.React.createElement(x,{style:{opacity:1},source:R.getAssetIDByName("ic_category_16px")}),trailing:e.React.createElement(q,{value:o.storage?.switches?.customizeable??!1,onValueChange:function(s){return o.storage.switches.customizeable=s}})}),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(v,{title:"Switches"}),e.React.createElement(F,null)),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(w,{style:[I.subText]},ue?.map(function(s,l){return e.React.createElement(e.React.Fragment,null,e.React.createElement(P,{label:s?.label,subLabel:s?.subLabel,leading:s?.icon&&e.React.createElement(x,{style:{opacity:1},source:R.getAssetIDByName(s?.icon)}),trailing:"id"in s?e.React.createElement(q,{value:o.storage?.switches[s?.id]??s?.default,onValueChange:function(g){return o.storage.switches[s?.id]=g}}):void 0}),l!==ue?.length-1&&e.React.createElement(F,null))}))),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(v,{title:"Text Variables"}),e.React.createElement(F,null)),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(w,{style:[I.subText]},fe?.map(function(s,l){return e.React.createElement(e.React.Fragment,null,e.React.createElement(nt,{title:s?.title,keyboardType:s?.type,placeholder:s?.placeholder,value:o.storage?.inputs[s.id]??s?.placeholder,onChange:function(g){return o.storage.inputs[s.id]=g.toString()}}),l!==fe.length-1&&e.React.createElement(F,null))}))),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(v,{title:"Color Pickers"}),e.React.createElement(F,null)),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(w,{style:[I.subText]},ge?.map(function(s){const l=function(){return Be(tt,{color:Y?.toInt(o.storage.colors[s.id]||s?.defaultColor||"#000"),onSelect:function(g){const C=Y?.toHex(g);o.storage.colors[s.id]=C}})};return e.React.createElement(e.React.Fragment,null,e.React.createElement(P,{label:s?.label,subLabel:s?.subLabel||"Click to Update",onPress:l,trailing:e.React.createElement(de,{onPress:l},e.React.createElement(rt,{source:{uri:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mJsrQAAAgwBAJ9P6qYAAAAASUVORK5CYII="},style:{width:32,height:32,borderRadius:10,backgroundColor:o.storage?.colors[s.id]||ge.find(function(g){return g?.id==s?.id})?.defaultColor||"#000"}}))}))}))),o.storage?.switches?.customizeable&&e.React.createElement(e.React.Fragment,null,e.React.createElement(w,{style:[I.subText]},e.React.createElement(w,{style:I.container},e.React.createElement(P,{style:{justifyContent:"center",alignItems:"center"},label:`Preview Style: ${o.storage?.switches?.darkMode?"Light":"Dark"} Mode`,subLabel:"Click to Switch Mode",trailing:e.React.createElement(q,{value:o.storage?.switches?.darkMode??!0,onValueChange:function(s){return o.storage.switches.darkMode=s}})}),e.React.createElement(w,{style:[I.row,I.border,{overflow:"hidden",marginRight:10}]},e.React.createElement(w,{style:{width:"2%",backgroundColor:`${o.storage.colors.gutterColor}${U(t)}`}}),e.React.createElement(w,{style:{flex:1,backgroundColor:`${o.storage.colors.backgroundColor}${U(a)}`,justifyContent:"center",alignItems:"center"}},e.React.createElement(ce,{style:{fontSize:20,color:o.storage?.switches?.darkMode?"black":"white"}}," Low Effort Normal Example Message "),e.React.createElement(ce,{style:{fontSize:20,color:o.storage.colors.textColor||"#000000"}}," Low Effort Deleted Example Message "))),e.React.createElement(F,null),e.React.createElement(P,{label:`Background Color Alpha: ${a}%`}),e.React.createElement(le,{style:{marginBottom:0,marginRight:10},value:a,onSlide:function(s){r(s),o.storage.colors.backgroundColorAlpha=U(s)}}),e.React.createElement(F,null),e.React.createElement(P,{label:`Background Gutter Alpha: ${t}%`}),e.React.createElement(le,{style:{marginBottom:0,marginRight:10},value:t,onSlide:function(s){c(s),o.storage.colors.gutterColorAlpha=U(s)}}))))),e.React.createElement(v,{title:"Ignore List Setting",style:[I.header]},e.React.createElement(P,{label:"Add User to List",subLabel:"List of ignored users for the plugin",leading:e.React.createElement(x,{style:{opacity:1},source:R.getAssetIDByName("ic_members")}),onPress:u,trailing:e.React.createElement(de,{onPress:u},e.React.createElement(x,{style:{opacity:1},source:st}))}),e.React.createElement(F,null))))}f.findByProps("openLazy","hideActionSheet");const Re=f.findByProps("getChannel","getDMFromUserId"),Ee=f.findByProps("_channelMessages");function lt(a){return _.before("dispatch",e.FluxDispatcher,function(r){const[t]=r,c=t?.type;if(c=="MESSAGE_DELETE"){if(t?.otherPluginBypass)return r;const n=Ee.get(t.channelId)?.get(t.id);if(!n||t?.id&&a[t?.id]?.stage==2)return r;if(t?.id&&a[t?.id]?.stage==1)return a[t?.id].stage=2,a[t?.id]?.message??r;const u=n?.author?.id,s=n?.author?.username,l=!n?.content&&n?.attachments?.length==0&&n?.embeds?.length==0;return!u||!s||l||o.storage?.switches?.ignoreBots&&n?.author?.bot||o.storage?.inputs?.ignoredUserList?.length>0&&o.storage.inputs.ignoredUserList?.some(function(g){return g?.id==n?.author?.id||g.username==n.author.username})||(r[0]={type:"MESSAGE_UPDATE",channelId:n?.channel_id||t?.channelId,message:{...n,content:n?.content,type:0,flags:64,channel_id:n?.channel_id||t?.channelId,guild_id:Re?.getChannel(n?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT",was_deleted:!0},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},a[t?.id||n?.id]={message:r,stage:1}),r}if(c=="MESSAGE_UPDATE"){if(t?.otherPluginBypass||t?.message?.author?.bot)return r;const n=Ee.get(t?.message?.channel_id)?.get(t?.message?.id),u=n?.author?.id,s=n?.author?.username,l=!n?.content&&n?.attachments?.length==0&&n?.embeds?.length==0;if(!n||!u||!s||l)return r;const g=t?.message?.content==n?.content,C=t?.message?.embeds.some(function(i){return i?.url==n?.content||i?.thumbnail?.url==n?.content||n?.content.includes(i?.url)||n?.content.includes(i?.thumbnail?.url)}),p=t?.message?.embeds?.size||t?.message?.embeds?.length,T=n?.embeds?.size||n?.embeds?.length;if(g||C||!t?.message?.content&&p!=T||o.storage?.inputs?.ignoredUserList?.length>0&&o.storage.inputs.ignoredUserList?.some(function(i){return i?.id==n?.author?.id||i.username==n.author.username}))return r;let S=o.storage?.inputs?.editedMessageBuffer||"`[ EDITED ]`";S=S+`

`;const d=t?.message||n;let h=`${n?.content}`;if(o.storage?.switches?.addTimestampForEdits){const i=Date.now(),b=`<t:${Math.abs(Math.round(i/1e3))}:R>`;h+=`  (${b}) ${S}${t?.message?.content??""}`}else h+=`  ${S}${t?.message?.content??""}`;return r[0]={type:"MESSAGE_UPDATE",message:{...d,content:h,guild_id:Re.getChannel(n?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},r}})}const ct=f.findByProps("startEditMessage");function dt(){return _.before("startEditMessage",ct,function(a){let r=o.storage?.inputs?.editedMessageBuffer||"`[ EDITED ]`";r=r+`

`;const[t,c,n]=a,u=n.split(r);return a[2]=u[u.length-1],a})}const{DCDChatManager:ut}=e.ReactNative.NativeModules;function gt(a){return _.before("updateRows",ut,function(r){let t=JSON.parse(r[1]);const{textColor:c,backgroundColor:n,backgroundColorAlpha:u,gutterColor:s,gutterColorAlpha:l}=o.storage.colors,g=o.storage.inputs?.deletedMessageBuffer,{useBackgroundColor:C,minimalistic:p,removeDismissButton:T}=o.storage.switches;function S(i,b){i||(i=b);const m=i?.trim();if(m.startsWith("#")){const y=m.slice(1);if(/^[0-9A-Fa-f]{6}$/.test(y))return"#"+y.toUpperCase()}else if(/^[0-9A-Fa-f]{6}$/.test(m))return"#"+m.toUpperCase();return b||"#000"}function d(i,b){const m=b?.toString(),y=["text","heading","s","u","em","strong","list","blockQuote"];if(Array.isArray(i))return i.map(function(A){return d(A,m)});if(typeof i=="object"&&i!==null){const{content:A,type:D,target:k,items:O}=i;if(!y.includes(D))return i;if(D==="text"&&A&&A.length>=1)return{content:[{content:A,type:"text"}],target:"usernameOnClick",type:"link",context:{username:1,medium:!0,usernameOnClick:{action:"0",userId:"0",linkColor:e.ReactNative.processColor(m),messageChannelId:"0"}}};const Z=d(A,m),Se=O?O.map(d,m):void 0;if(Z!==A||Se!==O||!y.includes(D)){const N={...i,content:Z};return D==="blockQuote"&&k&&(N.content=Z,N.target=k),D==="list"&&N?.content&&delete N.content,O&&(N.items=Se),N}}return i}function h(i,b,m){return i&&(b!=null&&(i.content[0].content[0].content=b+"  "),m==null&&i.content[0].content.splice(1)),i}return t.forEach(function(i){if(i?.type==1&&a[i?.message?.id]){if(i.message.edited=g?.length>0?g:"This message is deleted",p==!1){const b=S(c,"#E40303"),m=d(i?.message?.content,b);i.message.content=m}if(T&&(i.message.ephemeralIndication=h(i.message.ephemeralIndication,void 0,void 0)),p==!1&&C==!0){const b=S(`${n}`,"#FF2C2F"),m=S(`${s}`,"#FF2C2F");i.backgroundHighlight={backgroundColor:e.ReactNative.processColor(`${b}${u}`),gutterColor:e.ReactNative.processColor(`${m}${l}`)}}}}),r[1]=JSON.stringify(t),r[1]})}const ft=f.findByProps("updateMessageRecord","createMessageRecord");function ht(){return _.after("createMessageRecord",ft,function(a,r){let[t]=a;r.was_deleted=t.was_deleted})}const Rt=f.findByName("MessageRecord",!1);function Et(){return _.after("default",Rt,function(a,r){let[t]=a;r.was_deleted=!!t.was_deleted})}const pe=f.findByProps("updateMessageRecord","createMessageRecord");function pt(){return _.instead("updateMessageRecord",pe,function(a,r){let[t,c]=a;return c.was_deleted?pe.createMessageRecord(c,t.reactions):r.apply(this,[t,c])})}const me=f.findByProps("openLazy","hideActionSheet"),mt=f.findByProps("getMessage","getMessages"),yt=f.findByProps("getChannel","getDMFromUserId"),ye=f.findByProps("_channelMessages"),{FormRow:bt,FormIcon:Ct}=B.Forms;ee(o.storage,{switches:{customizeable:!1,useBackgroundColor:!1,ignoreBots:!1,minimalistic:!0,alwaysAdd:!1,darkMode:!0,removeDismissButton:!1,addTimestampForEdits:!1,timestampStyle:"R"},colors:{textColor:"#E40303",backgroundColor:"#FF2C2F",backgroundColorAlpha:"33",gutterColor:"#FF2C2F",gutterColorAlpha:"CC"},inputs:{deletedMessageBuffer:"This message is deleted",editedMessageBuffer:"`[ EDITED ]`",ignoredUserList:[]}});let be=[],Ce={};var St={onLoad:function(){be.push(lt(Ce),gt(Ce),dt(),ht(),Et(),pt(),_.before("openLazy",me,function(a){let[r,t,c]=a;const n=c?.message;t!=="MessageLongPressActionSheet"||!n||r.then(function(u){const s=_.after("default",u,function(l,g){e.React.useEffect(function(){return function(){s()}},[]);const C=Ie.findInReactTree(g,function(d){return d?.[0]?.type?.name==="ButtonRow"});if(!C)return g;const p=Math.max(C.findIndex(function(d){return d?.props?.message===e.i18n?.Messages?.MESSAGE_ACTION_REPLY}),0),T=mt.getMessage(n.channel_id,n?.id),S=function(d){return d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(o.storage?.inputs?.editedMessageBuffer||"`[ EDITED ]`");if(new RegExp(S,"gmi").test(n.content)){const d=p||1;C.splice(d,0,e.React.createElement(bt,{label:"Remove Edit History",leading:e.React.createElement(Ct,{style:{opacity:1},source:R.getAssetIDByName("ic_edit_24px")}),onPress:function(){let h=o.storage?.inputs?.editedMessageBuffer||"`[ EDITED ]`";h=h+`

`;const i=n?.content?.split(h),b=i[i.length-1],m=n?.embeds?.map(function(y){const A=y?.color?.replace(/.+\(/,"")?.replace(/\%/g,"")?.replace(")","")?.split(", "),D=e.ReactNative.processColor(`${_e(Y.HSLtoHEX(A[0],A[1],A[2]),A[3])}`);return{...y,author:y.author,title:y.rawTitle,description:y.rawDescription,url:y.url,type:y.type,image:y.image,thumbnail:y.thumbnail,color:D,content_scan_version:1}});e.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...n,content:`${b}`,embeds:m??[],attachments:n.attachments??[],mentions:n.mentions??[],guild_id:yt.getChannel(T.channel_id).guild_id},otherPluginBypass:!0}),me.hideActionSheet(),H.showToast("[ANTI ED] History Removed",R.getAssetIDByName("ic_edit_24px"))}}))}})})}))},onUnload:function(){for(const a of be)a();for(const a in ye._channelMessages)for(const r of ye._channelMessages[a]._array)r.was_deleted&&e.FluxDispatcher.dispatch({type:"MESSAGE_DELETE",id:r.id,channelId:r.channel_id,otherPluginBypass:!0})},settings:it};return z.default=St,Object.defineProperty(z,"__esModule",{value:!0}),z})({},vendetta,vendetta.metro,vendetta.plugin,vendetta.storage,vendetta.ui.components,vendetta.ui.assets,vendetta.metro.common,vendetta.ui,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.patcher,vendetta.utils);
