(function(g,s,y,n,R,E,f,p,c){"use strict";const{FormRow:_,FormSwitch:M,FormSwitchRow:C,FormSection:x,FormDivider:D,FormInput:v}=E.Forms,{ScrollView:A,View:o,Text:T}=E.General,d=s.stylesheet.createThemedStyleSheet({text:{color:f.semanticColors.HEADER_SECONDARY,paddingLeft:"4.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:s.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:f.semanticColors.TEXT_POSITIVE,paddingLeft:"5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:s.constants.Fonts.DISPLAY_NORMAL,fontSize:12}}),m=[{id:"msg_useDeleted",default:!1,label:"use DELETED",subLabel:"use [ DELETED ] instead of using ephemeral message. Will override Normal Ephemeral",icon:"ic_edit_24px"},{id:"msg_normalEphemeral",default:!1,label:"use Normal Ephemeral",subLabel:"use normal ephemeral message instead of red warning ephemeral message.",icon:"img_feed_error_dark"},{id:"useTimestamps",default:!1,label:"Enable Timestamp",subLabel:"This option is for red warning ephemeral message. Show the time of deletion (if using normal ephemeral or [DELETED], this option will be ignored)",icon:"ic_clock_timeout_16px"},{id:"useAMPM",default:!1,label:"Use AM/PM",subLabel:"This option is for red warning ephemeral message.",icon:"ic_globe_24px"}];let L=[{id:"del_var",title:"Customize Deleted",type:"default",placeholder:"`[ DELETED ]`"},{id:"edit_var",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"}];function I(){return y.useProxy(n.storage),s.React.createElement(A,null,s.React.createElement(o,{style:{marginTop:20}},s.React.createElement(o,{style:{marginTop:10}},s.React.createElement(T,{style:[d.text,d.optionText]},"Customize Separator".toUpperCase()),s.React.createElement(o,{style:[d.subText]},L.map(function(e,t){return s.React.createElement(s.React.Fragment,null,s.React.createElement(v,{title:e.title,keyboardType:e.type,placeholder:e.placeholder,value:n.storage[e.id]??e.placeholder,onChange:function(a){return n.storage[e.id]=a.toString()}}),t!==m.length-1&&s.React.createElement(D,null))})),s.React.createElement(T,{style:[d.text,d.optionText]},"Preferences".toUpperCase()),s.React.createElement(o,{style:[d.subText]},m.map(function(e,t){return s.React.createElement(s.React.Fragment,null,s.React.createElement(_,{label:e.label,subLabel:e.subLabel,leading:e.icon&&s.React.createElement(_.Icon,{source:R.getAssetIDByName(e.icon)}),trailing:"id"in e?s.React.createElement(M,{value:n.storage[e.id]??e.default,onValueChange:function(a){return n.storage[e.id]=a}}):void 0}),t!==m.length-1&&s.React.createElement(D,null))})))))}const S=c.findByProps("getMessage","getMessages"),u=c.findByProps("getChannel","getDMFromUserId"),P=c.findByProps("startEditMessage");let i={};function F(e,t){let{[e]:a,...l}=t;return l}const w={onLoad(){this.self=p.before("startEditMessage",P,function(e){let t=n.storage.edit_var,a=`${t?.length?t:"`[ EDITED ]`"}

`;const[l,r,h]=e,b=h.split(a);return e[2]=b[b.length-1],e}),this.messageLogger=p.before("dispatch",s.FluxDispatcher,function(e){const[t]=e;if(t.type==="MESSAGE_DELETE"){if(i[t.id]&&i[t.id].modified==2)return i=F(t.id,i),e;if(i[t.id]&&i[t.id].modified==1)return i[t.id].modified=2,i[t.id].arg;if(!Boolean(n.storage.msg_useDeleted)&&!Boolean(n.storage.msg_normalEphemeral)){if(!t?.id||!t?.channelId)return;let l=n.storage.message?.trim?.()||"This message was deleted";return n.storage.useTimestamps&&(l+=` (${s.moment().format(n.storage.useAMPM?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),e[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:t.channelId,messageId:t.id}},errorResponseBody:{code:2e5,message:l}},i[t.id]={arg:e,modified:1},e}const a=S.getMessage(e[0].channelId,e[0].id);if(Boolean(n.storage.msg_useDeleted)==!0){let l=n.storage.del_var||"`[ DELETED ]`";return!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||(e[0]={type:"MESSAGE_UPDATE",message:{...a,edited_timestamp:"invalid_timestamp",content:`${a?.content} ${l}`,guild_id:u.getChannel(a?.channel_id)?.guild_id}},i[t.id]={arg:e,modified:1}),e}if(Boolean(n.storage.msg_normalEphemeral)==!0)return!a?.author?.id||!a?.author?.username||!a?.content&&a?.attachments?.length==0&&a?.embeds?.length==0||(e[0]={type:"MESSAGE_UPDATE",channelId:a?.channel_id,message:{...a,content:a?.content,type:0,flags:64,channel_id:a?.channel_id,guild_id:u?.getChannel(a?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},i[t.id]={arg:e,modified:1}),e}if(t.type==="MESSAGE_UPDATE"){let a=n.storage.edit_var,l=`${a?.length?a:"`[ EDITED ]`"}

`;const r=S.getMessage(e[0].message?.channel_id,e[0].message?.id);if(e[0].message?.author?.bot||r?.author?.bot||!r?.author?.id||!r?.author?.username||!r?.content&&r?.attachments?.length==0&&r?.embeds?.length==0||t?.message?.content==r.content)return e;let h=t?.message??r;return e[0]={type:"MESSAGE_UPDATE",message:{...h,content:`${r?.content}  ${l}${t?.message?.content??""}`,guild_id:u.getChannel(r?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},e}})},onUnload(){this.self?.(),this.messageLogger?.()},settings:I};return g.default=w,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
