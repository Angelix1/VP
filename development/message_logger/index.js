(function(d,s,D,n,b,c,S,u,o){"use strict";const{FormRow:h,FormSwitch:T,FormSwitchRow:I,FormSection:F,FormDivider:M}=c.Forms,{ScrollView:R,View:g,Text:y}=c.General,E=s.stylesheet.createThemedStyleSheet({text:{color:S.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:s.constants.Fonts.PRIMARY_BOLD,fontSize:12}}),f=[{id:"msg_useDeleted",default:!1,label:"use DELETED",subLabel:"use [ DELETED ] instead of using ephemeral message. Will override Normal Ephemeral",icon:"ic_edit_24px"},{id:"msg_normalEphemeral",default:!1,label:"use Normal Ephemeral",subLabel:"use normal ephemeral message instead of red warning ephemeral message.",icon:"img_feed_error_dark"},{id:"useTimestamps",default:!1,label:"Enable Timestamp",subLabel:"This option is for red warning ephemeral message. Show the time of deletion (if using normal ephemeral or [DELETED], this option will be ignored)",icon:"ic_clock_timeout_16px"},{id:"useAMPM",default:!1,label:"Use AM/PM",subLabel:"This option is for red warning ephemeral message.",icon:"ic_globe_24px"}];function A(){return s.React.useReducer(function(e){return~e},0),D.useProxy(n.storage),s.React.createElement(R,null,s.React.createElement(g,{style:{marginTop:20}},s.React.createElement(g,{style:{marginTop:10}},s.React.createElement(y,{style:[E.text,E.optionText]},"Preferences".toUpperCase()),s.React.createElement(g,null,f.map(function(e,a){const[t,r]=s.React.useState(t);return s.React.createElement(s.React.Fragment,null,s.React.createElement(h,{label:e.label,subLabel:e.subLabel,leading:e.icon&&s.React.createElement(h.Icon,{source:b.getAssetIDByName(e.icon)}),trailing:"id"in e?s.React.createElement(T,{value:n.storage[e.id]??e.default,onValueChange:function(l){return n.storage[e.id]=l}}):void 0}),a!==f.length-1&&s.React.createElement(M,null))})))))}const _=o.findByProps("getMessage","getMessages"),m=o.findByProps("getChannel","getDMFromUserId"),L=o.findByProps("startEditMessage");let i={},p="`[ EDITED ]`\n\n",P="`[ DELETED ]`";function v(e,a){let{[e]:t,...r}=a;return r}const w={onLoad(){this.self=u.before("startEditMessage",L,function(e){const[a,t,r]=e,l=r.split(p);return e[2]=l[l.length-1],e}),this.messageLogger=u.before("dispatch",s.FluxDispatcher,function(e){n.storage.msg_normalEphemeral??=!1,n.storage.msg_useDeleted??=!1,n.storage.useTimestamps??=!1,n.storage.useAMPM??=!1;const[a]=e;if(a.type==="MESSAGE_DELETE"){const t=_.getMessage(e[0].channelId,e[0].id);if(i[a.id]&&i[a.id].modified==2)return i=v(a.id,i),e;if(i[a.id]&&i[a.id].modified==1)return i[a.id].modified=2,i[a.id].arg;if(Boolean(n.storage.msg_useDeleted)==!0)return e[0]={type:"MESSAGE_UPDATE",message:{...t,edited_timestamp:"invalid_timestamp",content:`${t?.content} ${P}`,guild_id:m.getChannel(t?.channel_id)?.guild_id}},i[a.id]={arg:e,modified:1},e;if(Boolean(n.storage.msg_normalEphemeral)==!0)return!t?.author?.id||!t?.author?.username||!t?.content&&t?.attachments?.length==0&&t?.embeds?.length==0||(e[0]={type:"MESSAGE_UPDATE",channelId:t?.channel_id,message:{...t,content:t?.content,type:0,flags:64,channel_id:t?.channel_id,guild_id:m?.getChannel(t?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},i[a.id]={arg:e,modified:1}),e;if(!a?.id||!a?.channelId)return;let r=n.storage.message?.trim?.()||"This message was deleted";return n.storage.useTimestamps&&(r+=` (${s.moment().format(n.storage.useAMPM?"hh:mm:ss.SS a":"HH:mm:ss.SS")})`),e[0]={type:"MESSAGE_EDIT_FAILED_AUTOMOD",messageData:{type:1,message:{channelId:a.channelId,messageId:a.id}},errorResponseBody:{code:2e5,message:r}},i[a.id]={arg:e,modified:1},e}if(a.type==="MESSAGE_UPDATE"){const t=_.getMessage(e[0].message?.channel_id,e[0].message?.id);if(e[0].message?.author?.bot||t?.author?.bot||!t?.author?.id||!t?.author?.username||!t?.content&&t?.attachments?.length==0&&t?.embeds?.length==0||a?.message?.content==t.content)return e;let r=a?.message??t;return e[0]={type:"MESSAGE_UPDATE",message:{...r,content:`${t?.content}  ${p}${a?.message?.content??""}`,guild_id:m.getChannel(t?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},e}})},onUnload(){this.self?.(),this.messageLogger?.()},settings:A};return d.default=w,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
