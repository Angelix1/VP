(function(E,t,A,o,D,T,f,m){"use strict";const{FormRow:k,FormSwitch:z,FormSwitchRow:B,FormSection:U,FormDivider:F,FormInput:b}=D.Forms,{ScrollView:P,View:y,Text:c}=D.General,l=t.stylesheet.createThemedStyleSheet({text:{color:T.semanticColors.HEADER_SECONDARY,paddingLeft:"5.5%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:16},subText:{color:T.semanticColors.TEXT_POSITIVE,paddingLeft:"6%",paddingRight:10,marginBottom:10,letterSpacing:.25,fontFamily:t.constants.Fonts.DISPLAY_NORMAL,fontSize:12}});let C=function(e){return e.toUpperCase()},S=[{id:"deletedMessageColor",title:"Customize Deleted Message Color ( DO NOT INCLUDE # )",type:"default",placeholder:"E40303"},{id:"deletedMessage",title:"Customize Deleted Message",type:"default",placeholder:"This message is deleted"},{id:"editedMessage",title:"Customize Edited Separator",type:"default",placeholder:"`[ EDITED ]`"}],I=[{version:"v0.0.8",patch:["Added Customizeable Text Color for Deleted Messages.","Changed Deleted Message Patch to use Discord Built-in.","Removed Option to use DELETED, NormalEphemeral, DefaultAutomodEphemeral","Removed Ephemeral Custom Settings.","Removed Ephemeral Patch."]}];function O(){return A.useProxy(o.storage),t.React.createElement(P,null,t.React.createElement(y,{style:{marginTop:20}},t.React.createElement(y,{style:{marginTop:10}},t.React.createElement(c,{style:[l.text,l.optionText]},C("Customize Separator")),t.React.createElement(y,{style:[l.subText]},S.map(function(e,n){return t.React.createElement(t.React.Fragment,null,t.React.createElement(b,{title:e.title,keyboardType:e.type,placeholder:e.placeholder,value:o.storage[e.id]??e.placeholder,onChange:function(r){return o.storage[e.id]=r.toString()}}),n!==S.length-1&&t.React.createElement(F,null))})),t.React.createElement(c,{style:[l.subText,l.optionText]},C("Reload the Plugin to Apply Color Change")),t.React.createElement(c,{style:[l.text,l.optionText]},"Changes"),I.map(function(e,n){return t.React.createElement(t.React.Fragment,null,t.React.createElement(c,{style:[l.text]},e.version||"Dev Version"),e.patch?.map(function(r){return t.React.createElement(t.React.Fragment,null,t.React.createElement(c,{style:[l.subText]},`- ${r}`))}))}))))}const N=m.findByProps("startEditMessage"),L=m.findByProps("getMessage","getMessages"),M=m.findByProps("getChannel","getDMFromUserId"),{DCDChatManager:$}=t.ReactNative.NativeModules;let v=[];const w={onLoad(){this.self=f.before("startEditMessage",N,function(e){let n=o.storage.edit_var.length?o.storage.edit_var:"`[ EDITED ]`";n=n+`

`;const[r,s,i]=e,a=i.split(n);return e[2]=a[a.length-1],e}),this.messageLogger=f.before("dispatch",t.FluxDispatcher,function(e){const[n]=e;let r=n.type;const s=L.getMessage(n?.channelId,n?.id);if(r==="MESSAGE_DELETE")return e[0]={type:"MESSAGE_UPDATE",channelId:s?.channel_id,message:{...s,content:`${s?.content} `,channel_id:s?.channel_id,guild_id:M?.getChannel(s?.channel_id)?.guild_id,timestamp:`${new Date().toJSON()}`,state:"SENT"},optimistic:!1,sendMessageOptions:{},isPushNotification:!1},v.push(n?.id),e;if(r==="MESSAGE_UPDATE"){let i=o.storage.editedMessage||"`[ EDITED ]`";if(i=i+`

`,e[0].message?.author?.bot||s?.author?.bot||!s?.author?.id||!s?.author?.username||!s?.content&&s?.attachments?.length==0&&s?.embeds?.length==0||n?.message?.content==s.content)return e;let a=n?.message??s;return e[0]={type:"MESSAGE_UPDATE",message:{...a,content:`${s?.content}  ${i}${n?.message?.content??""}`,guild_id:M.getChannel(s?.channel_id)?.guild_id,edited_timestamp:"invalid_timestamp"}},e}}),this.colorText=f.before("updateRows",$,function(e){let n=JSON.parse(e[1]),r=o.storage.deletedMessageColor||"E40303",s=/[0-9A-Fa-f]{6}/;r.match(s)||(r="E40303");function i(a){const h=["text","heading","s","u","em","strong","list","blockQuote"];if(Array.isArray(a))return a.map(i);if(typeof a=="object"&&a!==null){const{content:g,type:u,target:_,context:G,items:p}=a;if(!h.includes(u))return a;if(u==="text"&&g&&g.length>=1)return{content:[{content:g,type:"text"}],target:"usernameOnClick",type:"link",context:{username:1,medium:!0,usernameOnClick:{action:"0",userId:"0",linkColor:t.ReactNative.processColor(`#${r.toString()}`),messageChannelId:"0"}}};const R=i(g),x=p?p.map(i):void 0;if(R!==g||x!==p||!h.includes(u)){const d={...a,content:R};return u==="blockQuote"&&_&&(d.content=R,d.target=_),u==="list"&&d.hasOwnProperty("content")&&delete d.content,p&&(d.items=x),d}}return a}n.forEach(function(a){if(a.type!=1)return;if(!v.includes(a?.message?.id))return a;let h=i(a?.message?.content);return a.message.content=h,a.message.edited=o.storage.deletedMessage||"This message is deleted",a}),e[1]=JSON.stringify(n)})},onUnload(){this.self?.(),this.colorText?.(),this.messageLogger?.()},settings:O};return E.default=w,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.metro.common,vendetta.storage,vendetta.plugin,vendetta.ui.components,vendetta.ui,vendetta.patcher,vendetta.metro);
