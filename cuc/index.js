(function(w,G,a,g,E,_,e,V,ue,T,$){"use strict";const{openLazy:z,hideActionSheet:ve}=a.findByProps("openLazy","hideActionSheet");function U(t,o){if(t!=null&&o!=null)for(const n of Object.keys(o))typeof o[n]=="object"&&!Array.isArray(o[n])?(typeof t[n]!="object"&&(t[n]={}),U(t[n],o[n])):t[n]??=o[n]}function H(t,o){try{z(new Promise(function(n){return n({default:t})}),"ActionSheet",o)}catch(n){G.logger.error(n.stack),showToast("Got error when opening ActionSheet! Please check debug logs")}}a.findByProps("openLazy","hideActionSheet");const{ScrollView:J,View:fe,Text:he,TouchableOpacity:Q,TextInput:ge,Pressable:ye,Image:Y}=E.General,{FormIcon:j,FormSwitchRow:Ae,FormSwitch:K,FormRow:D,FormInput:me,FormDivider:q}=E.Forms,W=a.findByName("CustomColorPickerActionSheet");function X(t){const o=t>>16&255,n=t>>8&255,r=t&255;return`#${(1<<24|o<<16|n<<8|r).toString(16).slice(1)}`}function b(t,o,n,r,l){return{id:t,label:o,sub:n,def:r,icon:l}}const O=[b("enableUsername","Toggle for username",null,!0,null),b("enableReply","Toggle for replied messages",null,!1,null),b("enableType","Toggle for typing indicator",null,!1,null),b("enableToMyself","Apply color only to myself","Only Modify your own username color instead all members.",!1,null)];function Z(){var t;V.useProxy(e.storage);const o=function(r){return g.ReactNative.processColor(r)},n=function(){var r;return H(W,{color:o(e.storage===null||e.storage===void 0||(r=e.storage.colors)===null||r===void 0?void 0:r.hex)||0,onSelect:function(l){const s=X(l);e.storage.colors.hex=s}})};return React.createElement(J,null,React.createElement(D,{label:"Color",subLabel:"Click to Update",onPress:n,trailing:React.createElement(Q,{onPress:n},React.createElement(Y,{source:{uri:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mJsrQAAAgwBAJ9P6qYAAAAASUVORK5CYII="},style:{width:96,height:96,borderRadius:10,backgroundColor:(e.storage===null||e.storage===void 0||(t=e.storage.colors)===null||t===void 0?void 0:t.hex)||"#000"}}))}),O?.map(function(r,l){return React.createElement(React.Fragment,null,React.createElement(D,{label:r?.label,subLabel:r?.sub,leading:r?.icon&&React.createElement(j,{style:{opacity:1},source:_.getAssetIDByName(r?.icon)}),trailing:"id"in r?React.createElement(K,{value:(e.storage===null||e.storage===void 0?void 0:e.storage.switches[r?.id])??r?.def,onValueChange:function(s){return e.storage.switches[r?.id]=s}}):void 0}),l!==O?.length-1&&React.createElement(q,null))}))}var p,N;const{Text:ee}=E.General,te=a.findByStoreName("ThemeStore"),oe=((p=a.find(function(t){var o,n;return(n=t.default)===null||n===void 0||(o=n.internal)===null||o===void 0?void 0:o.resolveSemanticColor}))===null||p===void 0?void 0:p.default.internal.resolveSemanticColor)??((N=a.find(function(t){var o;return(o=t.meta)===null||o===void 0?void 0:o.resolveSemanticColor}))===null||N===void 0?void 0:N.meta.resolveSemanticColor)??function(){},S=a.findByStoreName("UserStore"),ne=a.findByStoreName("RelationshipStore"),re=a.findByStoreName("GuildMemberStore"),x=a.findByProps("TYPING_WRAPPER_HEIGHT"),{DCDChatManager:le}=g.ReactNative.NativeModules;U(e.storage,{colors:{hex:"#DAFAF0"},switches:{enableUsername:!0,enableReply:!1,enableType:!1,enableToMyself:!1}});function ae(t){var o;return!(t==null||(o=t.colors)===null||o===void 0)&&o.hex?g.ReactNative.processColor(t.colors.hex):0}const L=[];var se={onLoad:function(){L.push(T.before("updateRows",le,function(t){let o=JSON.parse(t[1]);for(const P of o){let R=function(){var i,v,f;if(!(e.storage===null||e.storage===void 0||(i=e.storage.switches)===null||i===void 0)&&i.enableUsername&&y(d),!(d==null||(v=d.referencedMessage)===null||v===void 0)&&v.message&&!(e.storage===null||e.storage===void 0||(f=e.storage.switches)===null||f===void 0)&&f.enableReply){var h;y(d==null||(h=d.referencedMessage)===null||h===void 0?void 0:h.message)}};var n,r,l,s;const{message:d}=P;if(!d)continue;const y=function(i){return i.usernameColor=ae(e.storage)};!(e.storage===null||e.storage===void 0||(n=e.storage.switches)===null||n===void 0)&&n.enableToMyself&&(S==null||(l=S.getCurrentUser)===null||l===void 0||(r=l.call(S))===null||r===void 0?void 0:r.id)==d?.authorId?R():!(e.storage===null||e.storage===void 0||(s=e.storage.switches)===null||s===void 0)&&s.enableToMyself||R()}t[1]=JSON.stringify(o)}),T.after("default",x,function(t,o){let[{channel:n}]=t;var r,l;if(!(!(e.storage===null||e.storage===void 0||(r=e.storage.switches)===null||r===void 0)&&r.enableType)||!o)return;const s=(l=o.props)===null||l===void 0?void 0:l.children,P=oe(te.theme,$.semanticColors.HEADER_SECONDARY),R=T.after("type",s,function(d,y){var i,v,f,h,M,B,F,C;g.React.useEffect(function(){return function(){R()}},[]);const A=y==null||(B=y.props)===null||B===void 0||(M=B.children)===null||M===void 0||(h=M[0])===null||h===void 0||(f=h.props)===null||f===void 0||(v=f.children)===null||v===void 0||(i=v[1])===null||i===void 0?void 0:i.props;if(!A||!A?.children||(A==null||(C=A.children)===null||C===void 0||(F=C.toLowerCase)===null||F===void 0?void 0:F.call(C))==="several people are typing...")return;const c=x.useTypingUserIds(n.id).map(function(u){var m;const ie=re.getMember(n.guild_id,u),k=S.getUser(u),ce=ie?.nick||ne.getNickname(u)||k.globalName||k.username,de=(e.storage===null||e.storage===void 0||(m=e.storage.colors)===null||m===void 0?void 0:m.hex)||P;return{displayName:ce,displayColor:de}});function I(u){return g.React.createElement(ee,{style:{color:u.displayColor,fontFamily:g.constants.Fonts.DISPLAY_SEMIBOLD}},u.displayName)}!c||c.length<1||(A.children=c.length===1?[I(c[0])," is typing..."]:[...c.slice(0,c.length-1).flatMap(function(u,m){return[I(u),m<c.length-2?", ":" and "]}),I(c[c.length-1])," are typing..."])})}))},onUnload:function(){L.forEach(function(t){return t()})},settings:Z};return w.default=se,Object.defineProperty(w,"__esModule",{value:!0}),w})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.plugin,vendetta.storage,vendetta.ui.toasts,vendetta.patcher,vendetta.ui);
