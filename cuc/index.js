(function(y,G,a,d,A,O,n,_,de,m,V){"use strict";const{openLazy:$,hideActionSheet:ve}=a.findByProps("openLazy","hideActionSheet");function x(e,t){if(e!=null&&t!=null)for(const o of Object.keys(t))typeof t[o]=="object"&&!Array.isArray(t[o])?(typeof e[o]!="object"&&(e[o]={}),x(e[o],t[o])):e[o]??=t[o]}function j(e,t){try{$(new Promise(function(o){return o({default:e})}),"ActionSheet",t)}catch(o){G.logger.error(o.stack),showToast("Got error when opening ActionSheet! Please check debug logs")}}a.findByProps("openLazy","hideActionSheet");const{ScrollView:z,View:fe,Text:ge,TouchableOpacity:H,TextInput:he,Pressable:ye,Image:J}=A.General,{FormIcon:Q,FormSwitchRow:Ae,FormSwitch:Y,FormRow:D,FormInput:me,FormDivider:K}=A.Forms,q=a.findByName("CustomColorPickerActionSheet");function W(e){const t=e>>16&255,o=e>>8&255,r=e&255;return`#${(1<<24|t<<16|o<<8|r).toString(16).slice(1)}`}function b(e,t,o,r,l){return{id:e,label:t,sub:o,def:r,icon:l}}const U=[b("enableUsername","Toggle for username",null,!0,null),b("enableReply","Toggle for replied messages",null,!1,null),b("enableType","Toggle for typing indicator",null,!1,null)];function X(){var e;_.useProxy(n.storage);const t=function(r){return d.ReactNative.processColor(r)},o=function(){var r;return j(q,{color:t(n.storage===null||n.storage===void 0||(r=n.storage.colors)===null||r===void 0?void 0:r.hex)||0,onSelect:function(l){const i=W(l);n.storage.colors.hex=i}})};return React.createElement(z,null,React.createElement(D,{label:"Color",subLabel:"Click to Update",onPress:o,trailing:React.createElement(H,{onPress:o},React.createElement(J,{source:{uri:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mJsrQAAAgwBAJ9P6qYAAAAASUVORK5CYII="},style:{width:96,height:96,borderRadius:10,backgroundColor:(n.storage===null||n.storage===void 0||(e=n.storage.colors)===null||e===void 0?void 0:e.hex)||"#000"}}))}),U?.map(function(r,l){return React.createElement(React.Fragment,null,React.createElement(D,{label:r?.label,subLabel:r?.sub,leading:r?.icon&&React.createElement(Q,{style:{opacity:1},source:O.getAssetIDByName(r?.icon)}),trailing:"id"in r?React.createElement(Y,{value:(n.storage===null||n.storage===void 0?void 0:n.storage.switches[r?.id])??r?.def,onValueChange:function(i){return n.storage.switches[r?.id]=i}}):void 0}),l!==U?.length-1&&React.createElement(K,null))}))}var S,R;const{Text:Z}=A.General,ee=a.findByStoreName("ThemeStore"),te=((S=a.find(function(e){var t,o;return(o=e.default)===null||o===void 0||(t=o.internal)===null||t===void 0?void 0:t.resolveSemanticColor}))===null||S===void 0?void 0:S.default.internal.resolveSemanticColor)??((R=a.find(function(e){var t;return(t=e.meta)===null||t===void 0?void 0:t.resolveSemanticColor}))===null||R===void 0?void 0:R.meta.resolveSemanticColor)??function(){},oe=a.findByStoreName("UserStore"),ne=a.findByStoreName("RelationshipStore"),re=a.findByStoreName("GuildMemberStore"),L=a.findByProps("TYPING_WRAPPER_HEIGHT"),{DCDChatManager:le}=d.ReactNative.NativeModules;x(n.storage,{colors:{hex:"#DAFAF0"},switches:{enableUsername:!0,enableReply:!1,enableType:!1}});function ae(e){var t;return!(e==null||(t=e.colors)===null||t===void 0)&&t.hex?d.ReactNative.processColor(e.colors.hex):0}const M=[];var ie={onLoad:function(){M.push(m.before("updateRows",le,function(e){let t=JSON.parse(e[1]);for(const p of t){var o,r,l;const{message:c}=p;if(!c)continue;const C=function(g){return g.usernameColor=ae(n.storage)};if(!(n.storage===null||n.storage===void 0||(o=n.storage.switches)===null||o===void 0)&&o.enableUsername&&C(c),!(c==null||(r=c.referencedMessage)===null||r===void 0)&&r.message&&!(n.storage===null||n.storage===void 0||(l=n.storage.switches)===null||l===void 0)&&l.enableReply){var i;C(c==null||(i=c.referencedMessage)===null||i===void 0?void 0:i.message)}}e[1]=JSON.stringify(t)}),m.after("default",L,function(e,t){let[{channel:o}]=e;var r,l;if(!(!(n.storage===null||n.storage===void 0||(r=n.storage.switches)===null||r===void 0)&&r.enableType)||!t)return;const i=(l=t.props)===null||l===void 0?void 0:l.children,p=te(ee.theme,V.semanticColors.HEADER_SECONDARY),c=m.after("type",i,function(C,g){var E,w,N,P,T,B,F,h;d.React.useEffect(function(){return function(){c()}},[]);const v=g==null||(B=g.props)===null||B===void 0||(T=B.children)===null||T===void 0||(P=T[0])===null||P===void 0||(N=P.props)===null||N===void 0||(w=N.children)===null||w===void 0||(E=w[1])===null||E===void 0?void 0:E.props;if(!v||!v?.children||(v==null||(h=v.children)===null||h===void 0||(F=h.toLowerCase)===null||F===void 0?void 0:F.call(h))==="several people are typing...")return;const s=L.useTypingUserIds(o.id).map(function(u){var f;const se=re.getMember(o.guild_id,u),k=oe.getUser(u),ce=se?.nick||ne.getNickname(u)||k.globalName||k.username,ue=(n.storage===null||n.storage===void 0||(f=n.storage.colors)===null||f===void 0?void 0:f.hex)||p;return{displayName:ce,displayColor:ue}});function I(u){return d.React.createElement(Z,{style:{color:u.displayColor,fontFamily:d.constants.Fonts.DISPLAY_SEMIBOLD}},u.displayName)}!s||s.length<1||(v.children=s.length===1?[I(s[0])," is typing..."]:[...s.slice(0,s.length-1).flatMap(function(u,f){return[I(u),f<s.length-2?", ":" and "]}),I(s[s.length-1])," are typing..."])})}))},onUnload:function(){M.forEach(function(e){return e()})},settings:X};return y.default=ie,Object.defineProperty(y,"__esModule",{value:!0}),y})({},vendetta,vendetta.metro,vendetta.metro.common,vendetta.ui.components,vendetta.ui.assets,vendetta.plugin,vendetta.storage,vendetta.ui.toasts,vendetta.patcher,vendetta.ui);
